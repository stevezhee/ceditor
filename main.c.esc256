[00;38;05;33m#include[m [00;38;05;196m"Cursor.h"[m
[00;38;05;33m#include[m [00;38;05;196m"Doc.h"[m
[00;38;05;33m#include[m [00;38;05;196m"DynamicArray.h"[m
[00;38;05;33m#include[m [00;38;05;196m"Font.h"[m
[00;38;05;33m#include[m [00;38;05;196m"Keysym.h"[m
[00;38;05;33m#include[m [00;38;05;196m"Util.h"[m
[00;38;05;33m#include[m [00;38;05;196m"Search.h"[m

[00;38;05;255mcolor_t[m unfocusedFrameColor [00;38;05;255m=[m [00;38;05;171m0x303030ff[m[00;38;05;255m;[m
[00;38;05;255mcolor_t[m focusedFrameColor [00;38;05;255m=[m [00;38;05;171m0x101010ff[m[00;38;05;255m;[m

[00;38;05;255mvoid[m [00;38;05;255minsertCString[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m);[m
[00;38;05;255mvoid[m [00;38;05;255minsertString[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m,[m [00;38;05;255muint[m len[00;38;05;255m);[m
[00;38;05;255mvoid[m [00;38;05;255mbuiltinInsertCString[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m);[m
[00;38;05;255mvoid[m [00;38;05;255mbuiltinInsertString[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m,[m [00;38;05;255muint[m len[00;38;05;255m);[m
[00;38;05;255mvoid[m [00;38;05;255mbuiltinInsertChar[m[00;38;05;255m([m[00;38;05;255muchar[m c[00;38;05;255m);[m

[00;38;05;75mtypedef[m [00;38;05;75menum[m [00;38;05;196m{[m HSPC[00;38;05;255m,[m VSPC[00;38;05;255m,[m DRAW[00;38;05;255m,[m COLOR[00;38;05;255m,[m FONT[00;38;05;255m,[m SCROLL_Y[00;38;05;255m,[m WID[00;38;05;255m,[m OVER[00;38;05;255m,[m HCAT[00;38;05;255m,[m VCAT[00;38;05;255m,[m HCATR[00;38;05;255m,[m VCATR[00;38;05;255m,[m NUM_WIDGET_TAGS [00;38;05;196m}[m widgetTag_t[00;38;05;255m;[m

[00;38;05;75mstruct[m [00;38;05;255mwidget_s[m[00;38;05;255m;[m

[00;38;05;75mtypedef[m [00;38;05;75mstruct[m [00;38;05;255mwidget_s[m widget_t[00;38;05;255m;[m

[00;38;05;75mstruct[m [00;38;05;255mwidget_s[m
[00;38;05;196m{[m
  [00;38;05;255mwidgetTag_t[m tag[00;38;05;255m;[m
  [00;38;05;75munion[m [00;38;05;196m{[m
    [00;38;05;255mint[m wid[00;38;05;255m;[m
    [00;38;05;255mint[m [00;38;05;255m*[mlength[00;38;05;255m;[m
    [00;38;05;255mint[m [00;38;05;255m*[mcolor[00;38;05;255m;[m
    [00;38;05;255mfont_t[m [00;38;05;255m**[mfont[00;38;05;255m;[m
    [00;38;05;255mwidget_t[m [00;38;05;255m*[mchild[00;38;05;255m;[m
    [00;38;05;255mvoid[m [00;38;05;255m(*[mdrawFun[00;38;05;255m)([m[00;38;05;255mvoid[m [00;38;05;255m*);[m
    [00;38;05;255mint[m [00;38;05;255m(*[mscrollYFun[00;38;05;255m)([m[00;38;05;255mvoid[m [00;38;05;255m*);[m
    [00;38;05;255mvoid[m [00;38;05;255m*[mdata[00;38;05;255m;[m
  [00;38;05;196m}[m a[00;38;05;255m;[m
  [00;38;05;75munion[m [00;38;05;196m{[m
    [00;38;05;255mwidget_t[m [00;38;05;255m*[mchild[00;38;05;255m;[m
    [00;38;05;255mvoid[m [00;38;05;255m*[mdata[00;38;05;255m;[m
  [00;38;05;196m}[m b[00;38;05;255m;[m
  [00;38;05;75munion[m [00;38;05;196m{[m
    [00;38;05;255mvoid[m [00;38;05;255m*[mdata[00;38;05;255m;[m
  [00;38;05;196m}[m c[00;38;05;255m;[m
[00;38;05;196m}[m[00;38;05;255m;[m

[00;38;05;255mstate_t[m st[00;38;05;255m;[m
[00;38;05;255mwidget_t[m [00;38;05;255m*[mgui[00;38;05;255m;[m
[00;38;05;255mint[m [00;38;05;255mxToColumn[m[00;38;05;255m([m[00;38;05;255mint[m x[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m x [00;38;05;255m/[m st[00;38;05;255m.[mfont[00;38;05;255m.[mcharSkip[00;38;05;255m;[m
[00;38;05;196m}[m
[00;38;05;255mint[m [00;38;05;255myToRow[m[00;38;05;255m([m[00;38;05;255mint[m x[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m x [00;38;05;255m/[m st[00;38;05;255m.[mfont[00;38;05;255m.[mlineSkip[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mint[m [00;38;05;255mnumFrames[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m st[00;38;05;255m.[mframes[00;38;05;255m.[mnumElems[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mint[m [00;38;05;255mnumDocs[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m st[00;38;05;255m.[mdocs[00;38;05;255m.[mnumElems[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255muint[m [00;38;05;255mframeRows[m[00;38;05;255m([m[00;38;05;255mframe_t[m [00;38;05;255m*[mframe[00;38;05;255m)[m
[00;38;05;196m{[m
    [00;38;05;75mreturn[m frame[00;38;05;255m->[mheight [00;38;05;255m/[m st[00;38;05;255m.[mfont[00;38;05;255m.[mlineSkip[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mint[m [00;38;05;255mfocusFrameRef[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m st[00;38;05;255m.[mframes[00;38;05;255m.[moffset[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mframe_t[m [00;38;05;255m*[m[00;38;05;255mfocusFrame[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m [00;38;05;255marrayFocus[m[00;38;05;255m(&[mst[00;38;05;255m.[mframes[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mframe_t[m [00;38;05;255m*[m[00;38;05;255mframeOf[m[00;38;05;255m([m[00;38;05;255mint[m i[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m [00;38;05;255marrayElemAt[m[00;38;05;255m(&[mst[00;38;05;255m.[mframes[00;38;05;255m,[m i[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mint[m [00;38;05;255mfocusViewRef[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m [00;38;05;255mfocusFrame[m[00;38;05;255m()->[mviews[00;38;05;255m.[moffset[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mview_t[m [00;38;05;255m*[m[00;38;05;255mviewOf[m[00;38;05;255m([m[00;38;05;255mframe_t[m [00;38;05;255m*[mframe[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m [00;38;05;255marrayFocus[m[00;38;05;255m(&[mframe[00;38;05;255m->[mviews[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mview_t[m [00;38;05;255m*[m[00;38;05;255mfocusView[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m [00;38;05;255mviewOf[m[00;38;05;255m([m[00;38;05;255mfocusFrame[m[00;38;05;255m());[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255msetFocusFrame[m[00;38;05;255m([m[00;38;05;255mint[m i[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255massert[m[00;38;05;255m([mi [00;38;05;255m>=[m [00;38;05;171m0[m[00;38;05;255m);[m
  [00;38;05;255massert[m[00;38;05;255m([mi [00;38;05;255m<[m [00;38;05;255mnumFrames[m[00;38;05;255m());[m
  [00;38;05;255mint[m j [00;38;05;255m=[m [00;38;05;255mfocusFrameRef[m[00;38;05;255m();[m
  [00;38;05;75mif[m [00;38;05;255m([mi [00;38;05;255m==[m j[00;38;05;255m)[m [00;38;05;75mreturn[m[00;38;05;255m;[m

  [00;38;05;255mframe_t[m [00;38;05;255m*[mframe [00;38;05;255m=[m [00;38;05;255mframeOf[m[00;38;05;255m([mj[00;38;05;255m);[m
  frame[00;38;05;255m->[mcolor [00;38;05;255m=[m unfocusedFrameColor[00;38;05;255m;[m
  [00;38;05;255marraySetFocus[m[00;38;05;255m(&[mst[00;38;05;255m.[mframes[00;38;05;255m,[m i[00;38;05;255m);[m
  frame [00;38;05;255m=[m [00;38;05;255mframeOf[m[00;38;05;255m([mi[00;38;05;255m);[m
  frame[00;38;05;255m->[mcolor [00;38;05;255m=[m focusedFrameColor[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mint[m [00;38;05;255mnumViews[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m [00;38;05;255mfocusFrame[m[00;38;05;255m()->[mviews[00;38;05;255m.[mnumElems[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mdoc_t[m [00;38;05;255m*[m[00;38;05;255mdocOf[m[00;38;05;255m([m[00;38;05;255mview_t[m [00;38;05;255m*[mview[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m [00;38;05;255marrayElemAt[m[00;38;05;255m(&[mst[00;38;05;255m.[mdocs[00;38;05;255m,[m view[00;38;05;255m->[mrefDoc[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mdoc_t[m [00;38;05;255m*[m[00;38;05;255mfocusDoc[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m [00;38;05;255mdocOf[m[00;38;05;255m([m[00;38;05;255mfocusView[m[00;38;05;255m());[m
[00;38;05;196m}[m

[00;38;05;255mcursor_t[m [00;38;05;255m*[m[00;38;05;255mfocusCursor[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m [00;38;05;255m&[m[00;38;05;255mfocusView[m[00;38;05;255m()->[mcursor[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mcursor_t[m [00;38;05;255m*[m[00;38;05;255mfocusSelection[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m [00;38;05;255m&[m[00;38;05;255mfocusView[m[00;38;05;255m()->[mselection[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mbool[m [00;38;05;255mselectionActive[m[00;38;05;255m([m[00;38;05;255mview_t[m [00;38;05;255m*[mview[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m [00;38;05;255m([mview[00;38;05;255m->[mselectMode [00;38;05;255m!=[m NO_SELECT[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mframeUpdate[m[00;38;05;255m([m[00;38;05;255mframe_t[m [00;38;05;255m*[mframe[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mview_t[m [00;38;05;255m*[mview [00;38;05;255m=[m [00;38;05;255mviewOf[m[00;38;05;255m([mframe[00;38;05;255m);[m
  [00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc [00;38;05;255m=[m [00;38;05;255mdocOf[m[00;38;05;255m([mview[00;38;05;255m);[m
  [00;38;05;255m// BAL: make sure we don't overflow the buffer[m
  [00;38;05;255marrayReinit[m[00;38;05;255m(&[mframe[00;38;05;255m->[mstatus[00;38;05;255m);[m
  [00;38;05;255msprintf[m[00;38;05;255m([mframe[00;38;05;255m->[mstatus[00;38;05;255m.[mstart[00;38;05;255m,[m [00;38;05;196m"<%s> %3d:%2d %s"[m[00;38;05;255m,[m editorModeDescr[00;38;05;255m[[mview[00;38;05;255m->[mmode[00;38;05;255m],[m view[00;38;05;255m->[mcursor[00;38;05;255m.[mrow [00;38;05;255m+[m [00;38;05;171m1[m[00;38;05;255m,[m view[00;38;05;255m->[mcursor[00;38;05;255m.[mcolumn[00;38;05;255m,[m doc[00;38;05;255m->[mfilepath[00;38;05;255m);[m
  frame[00;38;05;255m->[mstatus[00;38;05;255m.[mnumElems [00;38;05;255m=[m [00;38;05;255mstrlen[m[00;38;05;255m([mframe[00;38;05;255m->[mstatus[00;38;05;255m.[mstart[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255msetFrameView[m[00;38;05;255m([m[00;38;05;255mint[m refFrame[00;38;05;255m,[m [00;38;05;255mint[m refView[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mframe_t[m [00;38;05;255m*[mframe [00;38;05;255m=[m [00;38;05;255mframeOf[m[00;38;05;255m([mrefFrame[00;38;05;255m);[m
  [00;38;05;255massert[m[00;38;05;255m([mrefView [00;38;05;255m<[m frame[00;38;05;255m->[mviews[00;38;05;255m.[mnumElems[00;38;05;255m);[m
  [00;38;05;255marraySetFocus[m[00;38;05;255m(&[mframe[00;38;05;255m->[mviews[00;38;05;255m,[m refView[00;38;05;255m);[m

  [00;38;05;255mframeUpdate[m[00;38;05;255m([mframe[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255msetFocusView[m[00;38;05;255m([m[00;38;05;255mint[m refView[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255msetFrameView[m[00;38;05;255m([m[00;38;05;255mfocusFrameRef[m[00;38;05;255m(),[m refView[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255m/* void stSetViewFocus(uint i) */[m
[00;38;05;255m/* { */[m
[00;38;05;255m/*     i = clamp(0, i, st.views.numElems - 1); */[m
[00;38;05;255m/*     frame_t *frame = focusFrame(); */[m
[00;38;05;255m/*     frame->refView = i; */[m
[00;38;05;255m/*     printf("file:%s\n", focusDoc()->filepath); */[m
[00;38;05;255m/* } */[m

[00;38;05;255mvoid[m [00;38;05;255mframeInit[m[00;38;05;255m([m[00;38;05;255mframe_t[m [00;38;05;255m*[mframe[00;38;05;255m)[m
[00;38;05;196m{[m
    [00;38;05;255mmemset[m[00;38;05;255m([mframe[00;38;05;255m,[m [00;38;05;171m0[m[00;38;05;255m,[m [00;38;05;75msizeof[m[00;38;05;255m([mframe_t[00;38;05;255m));[m
    frame[00;38;05;255m->[mcolor [00;38;05;255m=[m unfocusedFrameColor[00;38;05;255m;[m

    [00;38;05;255marrayInit[m[00;38;05;255m(&[mframe[00;38;05;255m->[mviews[00;38;05;255m,[m [00;38;05;75msizeof[m[00;38;05;255m([mview_t[00;38;05;255m));[m
    [00;38;05;255marrayInit[m[00;38;05;255m(&[mframe[00;38;05;255m->[mstatus[00;38;05;255m,[m [00;38;05;75msizeof[m[00;38;05;255m([m[00;38;05;255mchar[m[00;38;05;255m));[m
    [00;38;05;255marrayGrow[m[00;38;05;255m(&[mframe[00;38;05;255m->[mstatus[00;38;05;255m,[m [00;38;05;171m1024[m[00;38;05;255m);[m
    [00;38;05;255m// printf("frame init: %d\n", (int)frame->status.start);[m
    [00;38;05;255m// printf("frame init status: %p %p %d %d\n", frame->status, frame->status.start, frame->status->numElems, frame->status->maxElems);[m
    [00;38;05;255m//    printf("status size buf=%p start=%p\n", frame->status, frame->status.start);[m

[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mviewInit[m[00;38;05;255m([m[00;38;05;255mview_t[m [00;38;05;255m*[mview[00;38;05;255m,[m [00;38;05;255muint[m i[00;38;05;255m)[m
[00;38;05;196m{[m
    [00;38;05;255mmemset[m[00;38;05;255m([mview[00;38;05;255m,[m [00;38;05;171m0[m[00;38;05;255m,[m [00;38;05;75msizeof[m[00;38;05;255m([mview_t[00;38;05;255m));[m
    view[00;38;05;255m->[mrefDoc [00;38;05;255m=[m i[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255m/* bool noActiveSearch(frame_t *frame) */[m
[00;38;05;255m/* { */[m
[00;38;05;255m/*     return */[m
[00;38;05;255m/*       frame->refView != st.searchRefView || // BAL: there are now multiple views per frame */[m
[00;38;05;255m/*       st.searchLen == 0 || */[m
[00;38;05;255m/*       st.searchResults.numElems == 0; */[m
[00;38;05;255m/* } */[m

[00;38;05;255mwidget_t[m [00;38;05;255m*[m[00;38;05;255mnewWidget[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m [00;38;05;255mdieIfNull[m[00;38;05;255m([m[00;38;05;255mmalloc[m[00;38;05;255m([m[00;38;05;75msizeof[m[00;38;05;255m([mwidget_t[00;38;05;255m)));[m
[00;38;05;196m}[m

[00;38;05;255mwidget_t[m [00;38;05;255m*[m[00;38;05;255mleaf[m[00;38;05;255m([m[00;38;05;255mwidgetTag_t[m tag[00;38;05;255m,[m [00;38;05;255mvoid[m [00;38;05;255m*[ma[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mwidget_t[m [00;38;05;255m*[mp [00;38;05;255m=[m [00;38;05;255mnewWidget[m[00;38;05;255m();[m
  p[00;38;05;255m->[mtag [00;38;05;255m=[m tag[00;38;05;255m;[m
  p[00;38;05;255m->[ma[00;38;05;255m.[mdata [00;38;05;255m=[m a[00;38;05;255m;[m
  [00;38;05;75mreturn[m p[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;33m#define[m [00;38;05;255mhspc[m[00;38;05;255m([mlen[00;38;05;255m)[m [00;38;05;255mleaf[m[00;38;05;255m([mHSPC[00;38;05;255m,[m len[00;38;05;255m)[m
[00;38;05;33m#define[m [00;38;05;255mvspc[m[00;38;05;255m([mlen[00;38;05;255m)[m [00;38;05;255mleaf[m[00;38;05;255m([mVSPC[00;38;05;255m,[m len[00;38;05;255m)[m

[00;38;05;255mwidget_t[m [00;38;05;255m*[m[00;38;05;255msingleton[m[00;38;05;255m([m[00;38;05;255mwidgetTag_t[m tag[00;38;05;255m,[m [00;38;05;255mvoid[m [00;38;05;255m*[ma[00;38;05;255m,[m [00;38;05;255mwidget_t[m [00;38;05;255m*[mb[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mwidget_t[m [00;38;05;255m*[mp [00;38;05;255m=[m [00;38;05;255mnewWidget[m[00;38;05;255m();[m
  p[00;38;05;255m->[mtag [00;38;05;255m=[m tag[00;38;05;255m;[m
  p[00;38;05;255m->[ma[00;38;05;255m.[mdata [00;38;05;255m=[m a[00;38;05;255m;[m
  p[00;38;05;255m->[mb[00;38;05;255m.[mchild [00;38;05;255m=[m b[00;38;05;255m;[m
  [00;38;05;75mreturn[m p[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mwidget_t[m [00;38;05;255m*[m[00;38;05;255msingleton2[m[00;38;05;255m([m[00;38;05;255mwidgetTag_t[m tag[00;38;05;255m,[m [00;38;05;255mvoid[m [00;38;05;255m*[ma[00;38;05;255m,[m [00;38;05;255mwidget_t[m [00;38;05;255m*[mb[00;38;05;255m,[m [00;38;05;255mvoid[m [00;38;05;255m*[mc[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mwidget_t[m [00;38;05;255m*[mp [00;38;05;255m=[m [00;38;05;255mnewWidget[m[00;38;05;255m();[m
  p[00;38;05;255m->[mtag [00;38;05;255m=[m tag[00;38;05;255m;[m
  p[00;38;05;255m->[ma[00;38;05;255m.[mdata [00;38;05;255m=[m a[00;38;05;255m;[m
  p[00;38;05;255m->[mb[00;38;05;255m.[mchild [00;38;05;255m=[m b[00;38;05;255m;[m
  p[00;38;05;255m->[mc[00;38;05;255m.[mdata [00;38;05;255m=[m c[00;38;05;255m;[m
  [00;38;05;75mreturn[m p[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;33m#define[m [00;38;05;255mcolor[m[00;38;05;255m([ma[00;38;05;255m,[m b[00;38;05;255m)[m [00;38;05;255msingleton[m[00;38;05;255m([mCOLOR[00;38;05;255m,[m a[00;38;05;255m,[m b[00;38;05;255m)[m
[00;38;05;33m#define[m [00;38;05;255mfont[m[00;38;05;255m([ma[00;38;05;255m,[m b[00;38;05;255m)[m [00;38;05;255msingleton[m[00;38;05;255m([mFONT[00;38;05;255m,[m a[00;38;05;255m,[m b[00;38;05;255m)[m
[00;38;05;33m#define[m [00;38;05;255mscrollY[m[00;38;05;255m([ma[00;38;05;255m,[m c[00;38;05;255m,[m b[00;38;05;255m)[m [00;38;05;255msingleton2[m[00;38;05;255m([mSCROLL_Y[00;38;05;255m,[m a[00;38;05;255m,[m b[00;38;05;255m,[m c[00;38;05;255m)[m

[00;38;05;255mwidget_t[m [00;38;05;255m*[m[00;38;05;255mwid[m[00;38;05;255m([m[00;38;05;255mint[m i[00;38;05;255m,[m [00;38;05;255mwidget_t[m [00;38;05;255m*[ma[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mwidget_t[m [00;38;05;255m*[mp [00;38;05;255m=[m [00;38;05;255mnewWidget[m[00;38;05;255m();[m
  p[00;38;05;255m->[mtag [00;38;05;255m=[m WID[00;38;05;255m;[m
  p[00;38;05;255m->[ma[00;38;05;255m.[mwid [00;38;05;255m=[m i[00;38;05;255m;[m
  p[00;38;05;255m->[mb[00;38;05;255m.[mchild [00;38;05;255m=[m a[00;38;05;255m;[m
  [00;38;05;75mreturn[m p[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mwidget_t[m [00;38;05;255m*[m[00;38;05;255mnode[m[00;38;05;255m([m[00;38;05;255mwidgetTag_t[m tag[00;38;05;255m,[m [00;38;05;255mvoid[m [00;38;05;255m*[ma[00;38;05;255m,[m [00;38;05;255mvoid[m [00;38;05;255m*[mb[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mwidget_t[m [00;38;05;255m*[mp [00;38;05;255m=[m [00;38;05;255mnewWidget[m[00;38;05;255m();[m
  p[00;38;05;255m->[mtag [00;38;05;255m=[m tag[00;38;05;255m;[m
  p[00;38;05;255m->[ma[00;38;05;255m.[mdata [00;38;05;255m=[m a[00;38;05;255m;[m
  p[00;38;05;255m->[mb[00;38;05;255m.[mdata [00;38;05;255m=[m b[00;38;05;255m;[m
  [00;38;05;75mreturn[m p[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;75mtypedef[m [00;38;05;75mstruct[m
[00;38;05;196m{[m
  [00;38;05;255mint[m x[00;38;05;255m;[m
  [00;38;05;255mint[m y[00;38;05;255m;[m
  [00;38;05;255mint[m w[00;38;05;255m;[m
  [00;38;05;255mint[m h[00;38;05;255m;[m
  [00;38;05;255mint[m color[00;38;05;255m;[m
  [00;38;05;255mfont_t[m [00;38;05;255m*[mfont[00;38;05;255m;[m
  [00;38;05;255mint[m dy[00;38;05;255m;[m
  [00;38;05;255mint[m wid[00;38;05;255m;[m
[00;38;05;196m}[m context_t[00;38;05;255m;[m

[00;38;05;255mcontext_t[m context[00;38;05;255m;[m

[00;38;05;255mvoid[m [00;38;05;255mdrawBox[m[00;38;05;255m([m[00;38;05;255mvoid[m [00;38;05;255m*[m_unused[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mfillRect[m[00;38;05;255m([mcontext[00;38;05;255m.[mw[00;38;05;255m,[m context[00;38;05;255m.[mh[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;33m#define[m [00;38;05;255mover[m[00;38;05;255m([ma[00;38;05;255m,[m b[00;38;05;255m)[m [00;38;05;255mnode[m[00;38;05;255m([mOVER[00;38;05;255m,[m a[00;38;05;255m,[m b[00;38;05;255m)[m
[00;38;05;33m#define[m [00;38;05;255mhcat[m[00;38;05;255m([ma[00;38;05;255m,[m b[00;38;05;255m)[m [00;38;05;255mnode[m[00;38;05;255m([mHCAT[00;38;05;255m,[m a[00;38;05;255m,[m b[00;38;05;255m)[m
[00;38;05;33m#define[m [00;38;05;255mhcatr[m[00;38;05;255m([ma[00;38;05;255m,[m b[00;38;05;255m)[m [00;38;05;255mnode[m[00;38;05;255m([mHCATR[00;38;05;255m,[m a[00;38;05;255m,[m b[00;38;05;255m)[m
[00;38;05;33m#define[m [00;38;05;255mvcat[m[00;38;05;255m([ma[00;38;05;255m,[m b[00;38;05;255m)[m [00;38;05;255mnode[m[00;38;05;255m([mVCAT[00;38;05;255m,[m a[00;38;05;255m,[m b[00;38;05;255m)[m
[00;38;05;33m#define[m [00;38;05;255mvcatr[m[00;38;05;255m([ma[00;38;05;255m,[m b[00;38;05;255m)[m [00;38;05;255mnode[m[00;38;05;255m([mVCATR[00;38;05;255m,[m a[00;38;05;255m,[m b[00;38;05;255m)[m
[00;38;05;33m#define[m [00;38;05;255mdraw[m[00;38;05;255m([ma[00;38;05;255m,[m b[00;38;05;255m)[m [00;38;05;255mnode[m[00;38;05;255m([mDRAW[00;38;05;255m,[m a[00;38;05;255m,[m b[00;38;05;255m)[m
[00;38;05;33m#define[m [00;38;05;255mbox[m[00;38;05;255m()[m [00;38;05;255mnode[m[00;38;05;255m([mDRAW[00;38;05;255m,[m drawBox[00;38;05;255m,[m NULL[00;38;05;255m)[m

[00;38;05;255mint[m [00;38;05;255mmaxLineLength[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255massert[m[00;38;05;255m([ms[00;38;05;255m);[m
  [00;38;05;255mchar[m c[00;38;05;255m;[m
  [00;38;05;255mint[m rmax [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m
  [00;38;05;255mint[m r [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m
  [00;38;05;75mwhile[m[00;38;05;255m(([mc [00;38;05;255m=[m [00;38;05;255m*[ms[00;38;05;255m)[m [00;38;05;255m!=[m [00;38;05;196m'[m[00;38;05;255m\0[m[00;38;05;196m'[m[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;75mswitch[m[00;38;05;255m([mc[00;38;05;255m)[m [00;38;05;196m{[m
      [00;38;05;75mcase[m [00;38;05;196m'[m[00;38;05;255m\n[m[00;38;05;196m'[m[00;38;05;255m:[m
        rmax [00;38;05;255m=[m [00;38;05;255mmax[m[00;38;05;255m([mrmax[00;38;05;255m,[m r [00;38;05;255m+[m [00;38;05;171m1[m[00;38;05;255m);[m
        r [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m
        [00;38;05;75mbreak[m[00;38;05;255m;[m
[00;38;05;255m      default:[m
        r[00;38;05;255m++;[m
      [00;38;05;196m}[m
      s[00;38;05;255m++;[m
    [00;38;05;196m}[m
  [00;38;05;75mreturn[m [00;38;05;255mmax[m[00;38;05;255m([mrmax[00;38;05;255m,[m r[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mint[m [00;38;05;255mnumLinesCString[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mint[m n [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m
  [00;38;05;255mchar[m c[00;38;05;255m;[m
  [00;38;05;75mwhile[m [00;38;05;255m(([mc [00;38;05;255m=[m [00;38;05;255m*[ms[00;38;05;255m)[m [00;38;05;255m!=[m [00;38;05;196m'[m[00;38;05;255m\0[m[00;38;05;196m'[m[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;75mif[m [00;38;05;255m([mc [00;38;05;255m==[m [00;38;05;196m'[m[00;38;05;255m\n[m[00;38;05;196m'[m[00;38;05;255m)[m n[00;38;05;255m++;[m
      s[00;38;05;255m++;[m
    [00;38;05;196m}[m
  [00;38;05;75mreturn[m n[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mdrawStringSelection[m[00;38;05;255m([m[00;38;05;255mint[m x[00;38;05;255m,[m [00;38;05;255mint[m y[00;38;05;255m,[m [00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m,[m [00;38;05;255mint[m len[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255m// BAL: would it look good to bold the characters in addition/instead?[m
  [00;38;05;255massert[m[00;38;05;255m([ms[00;38;05;255m);[m
  [00;38;05;255mint[m w [00;38;05;255m=[m context[00;38;05;255m.[mfont[00;38;05;255m->[mcharSkip[00;38;05;255m;[m
  [00;38;05;255mint[m h [00;38;05;255m=[m context[00;38;05;255m.[mfont[00;38;05;255m->[mlineSkip[00;38;05;255m;[m
  [00;38;05;255mchar[m [00;38;05;255m*[mp [00;38;05;255m=[m s [00;38;05;255m+[m len[00;38;05;255m;[m
  [00;38;05;75mwhile[m[00;38;05;255m([ms [00;38;05;255m<[m p[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255mfillRectAt[m[00;38;05;255m([mx[00;38;05;255m,[m y[00;38;05;255m,[m w[00;38;05;255m,[m h[00;38;05;255m);[m
      [00;38;05;75mswitch[m[00;38;05;255m(*[ms[00;38;05;255m)[m [00;38;05;196m{[m
      [00;38;05;75mcase[m [00;38;05;196m'[m[00;38;05;255m\n[m[00;38;05;196m'[m[00;38;05;255m:[m
        x [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m
        y [00;38;05;255m+=[m h[00;38;05;255m;[m
        [00;38;05;75mbreak[m[00;38;05;255m;[m
[00;38;05;255m      default:[m
        x [00;38;05;255m+=[m w[00;38;05;255m;[m
      [00;38;05;196m}[m
      s[00;38;05;255m++;[m
    [00;38;05;196m}[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mdrawString[m[00;38;05;255m([m[00;38;05;255mstring_t[m [00;38;05;255m*[ms[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;75mif[m[00;38;05;255m(![ms[00;38;05;255m)[m [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;255massert[m[00;38;05;255m([ms[00;38;05;255m);[m
  [00;38;05;75mif[m [00;38;05;255m(![ms[00;38;05;255m->[mstart[00;38;05;255m)[m [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;255muchar[m c[00;38;05;255m;[m
  [00;38;05;255mSDL_Texture[m [00;38;05;255m*[mtxtr[00;38;05;255m;[m
  [00;38;05;255mSDL_Rect[m rect[00;38;05;255m;[m
  rect[00;38;05;255m.[mx [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m [00;38;05;255m// context.dx;[m
  rect[00;38;05;255m.[my [00;38;05;255m=[m context[00;38;05;255m.[mdy[00;38;05;255m;[m
  rect[00;38;05;255m.[mw [00;38;05;255m=[m context[00;38;05;255m.[mfont[00;38;05;255m->[mcharSkip[00;38;05;255m;[m
  rect[00;38;05;255m.[mh [00;38;05;255m=[m context[00;38;05;255m.[mfont[00;38;05;255m->[mlineSkip[00;38;05;255m;[m

  [00;38;05;255mchar[m [00;38;05;255m*[mp [00;38;05;255m=[m s[00;38;05;255m->[mstart[00;38;05;255m;[m
  [00;38;05;255mchar[m [00;38;05;255m*[mq [00;38;05;255m=[m [00;38;05;255marrayTop[m[00;38;05;255m([ms[00;38;05;255m);[m

  [00;38;05;75mwhile[m[00;38;05;255m([mp [00;38;05;255m<[m q[00;38;05;255m)[m
    [00;38;05;196m{[m
      c [00;38;05;255m=[m [00;38;05;255m*[mp[00;38;05;255m;[m
      p[00;38;05;255m++;[m
      [00;38;05;75mswitch[m[00;38;05;255m([mc[00;38;05;255m)[m [00;38;05;196m{[m
      [00;38;05;75mcase[m [00;38;05;196m'[m[00;38;05;255m\n[m[00;38;05;196m'[m[00;38;05;255m:[m
        rect[00;38;05;255m.[mx [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m [00;38;05;255m// context.dx;[m
        rect[00;38;05;255m.[my [00;38;05;255m+=[m rect[00;38;05;255m.[mh[00;38;05;255m;[m
        [00;38;05;75mbreak[m[00;38;05;255m;[m
      [00;38;05;75mcase[m [00;38;05;196m' '[m[00;38;05;255m:[m
        rect[00;38;05;255m.[mx [00;38;05;255m+=[m rect[00;38;05;255m.[mw[00;38;05;255m;[m
        [00;38;05;75mbreak[m[00;38;05;255m;[m
[00;38;05;255m      default:[m
        txtr [00;38;05;255m=[m context[00;38;05;255m.[mfont[00;38;05;255m->[mcharTexture[00;38;05;255m[[mc[00;38;05;255m];[m
        [00;38;05;255msetTextureColorMod[m[00;38;05;255m([mtxtr[00;38;05;255m,[m context[00;38;05;255m.[mcolor[00;38;05;255m);[m [00;38;05;255m// BAL: could just do this once if using a texture map[m
        [00;38;05;255mSDL_RenderCopy[m[00;38;05;255m([mrenderer[00;38;05;255m,[m txtr[00;38;05;255m,[m NULL[00;38;05;255m,[m [00;38;05;255m&[mrect[00;38;05;255m);[m
        rect[00;38;05;255m.[mx [00;38;05;255m+=[m rect[00;38;05;255m.[mw[00;38;05;255m;[m
      [00;38;05;196m}[m
    [00;38;05;196m}[m
[00;38;05;196m}[m

[00;38;05;255mint[m [00;38;05;255mwidgetWidth[m[00;38;05;255m([m[00;38;05;255mwidget_t[m [00;38;05;255m*[mwidget[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mint[m w [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m

  [00;38;05;75mswitch[m [00;38;05;255m([mwidget[00;38;05;255m->[mtag[00;38;05;255m)[m [00;38;05;196m{[m
  [00;38;05;75mcase[m HCATR[00;38;05;255m:[m [00;38;05;255m// fall through[m
  [00;38;05;75mcase[m HCAT[00;38;05;255m:[m
    w [00;38;05;255m=[m [00;38;05;255mwidgetWidth[m[00;38;05;255m([mwidget[00;38;05;255m->[ma[00;38;05;255m.[mchild[00;38;05;255m)[m [00;38;05;255m+[m [00;38;05;255mwidgetWidth[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m);[m
    [00;38;05;75mbreak[m[00;38;05;255m;[m
  [00;38;05;75mcase[m OVER[00;38;05;255m:[m [00;38;05;255m// fall through[m
  [00;38;05;75mcase[m VCATR[00;38;05;255m:[m [00;38;05;255m// fall through[m
  [00;38;05;75mcase[m VCAT[00;38;05;255m:[m
    w [00;38;05;255m=[m [00;38;05;255mmax[m[00;38;05;255m([m[00;38;05;255mwidgetWidth[m[00;38;05;255m([mwidget[00;38;05;255m->[ma[00;38;05;255m.[mchild[00;38;05;255m),[m [00;38;05;255mwidgetWidth[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m));[m
    [00;38;05;75mbreak[m[00;38;05;255m;[m
  [00;38;05;75mcase[m SCROLL_Y[00;38;05;255m:[m [00;38;05;255m// fall through[m
  [00;38;05;75mcase[m WID[00;38;05;255m:[m [00;38;05;255m// fall through[m
  [00;38;05;75mcase[m COLOR[00;38;05;255m:[m [00;38;05;255m// fall through[m
  [00;38;05;75mcase[m FONT[00;38;05;255m:[m
    w [00;38;05;255m=[m [00;38;05;255mwidgetWidth[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m);[m
    [00;38;05;75mbreak[m[00;38;05;255m;[m
  [00;38;05;75mcase[m HSPC[00;38;05;255m:[m
    w [00;38;05;255m=[m [00;38;05;255m*[mwidget[00;38;05;255m->[ma[00;38;05;255m.[mlength[00;38;05;255m;[m
    [00;38;05;75mbreak[m[00;38;05;255m;[m
[00;38;05;255m  default:[m
    [00;38;05;255massert[m[00;38;05;255m([mwidget[00;38;05;255m->[mtag [00;38;05;255m==[m VSPC [00;38;05;255m||[m widget[00;38;05;255m->[mtag [00;38;05;255m==[m DRAW[00;38;05;255m);[m
    [00;38;05;75mbreak[m[00;38;05;255m;[m
  [00;38;05;196m}[m

  [00;38;05;75mreturn[m [00;38;05;255mmin[m[00;38;05;255m([mw[00;38;05;255m,[m context[00;38;05;255m.[mw[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mint[m [00;38;05;255mwidgetHeight[m[00;38;05;255m([m[00;38;05;255mwidget_t[m [00;38;05;255m*[mwidget[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mint[m h [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m
  [00;38;05;75mswitch[m [00;38;05;255m([mwidget[00;38;05;255m->[mtag[00;38;05;255m)[m
    [00;38;05;196m{[m
    [00;38;05;75mcase[m OVER[00;38;05;255m:[m [00;38;05;255m// fall through[m
    [00;38;05;75mcase[m HCATR[00;38;05;255m:[m [00;38;05;255m// fall through[m
    [00;38;05;75mcase[m HCAT[00;38;05;255m:[m
      h [00;38;05;255m=[m [00;38;05;255mmax[m[00;38;05;255m([m[00;38;05;255mwidgetHeight[m[00;38;05;255m([mwidget[00;38;05;255m->[ma[00;38;05;255m.[mchild[00;38;05;255m),[m [00;38;05;255mwidgetHeight[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m));[m
      [00;38;05;75mbreak[m[00;38;05;255m;[m
    [00;38;05;75mcase[m VCATR[00;38;05;255m:[m [00;38;05;255m// fall through[m
    [00;38;05;75mcase[m VCAT[00;38;05;255m:[m
      h [00;38;05;255m=[m [00;38;05;255mwidgetHeight[m[00;38;05;255m([mwidget[00;38;05;255m->[ma[00;38;05;255m.[mchild[00;38;05;255m)[m [00;38;05;255m+[m [00;38;05;255mwidgetHeight[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m);[m
      [00;38;05;75mbreak[m[00;38;05;255m;[m
    [00;38;05;75mcase[m SCROLL_Y[00;38;05;255m:[m [00;38;05;255m// fall through[m
    [00;38;05;75mcase[m COLOR[00;38;05;255m:[m [00;38;05;255m// fall through[m
    [00;38;05;75mcase[m WID[00;38;05;255m:[m [00;38;05;255m// fall through[m
    [00;38;05;75mcase[m FONT[00;38;05;255m:[m
      h [00;38;05;255m=[m [00;38;05;255mwidgetHeight[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m);[m
      [00;38;05;75mbreak[m[00;38;05;255m;[m
    [00;38;05;75mcase[m VSPC[00;38;05;255m:[m
      h [00;38;05;255m=[m [00;38;05;255m*[mwidget[00;38;05;255m->[ma[00;38;05;255m.[mlength[00;38;05;255m;[m
      [00;38;05;75mbreak[m[00;38;05;255m;[m
[00;38;05;255m    default:[m
      [00;38;05;255massert[m[00;38;05;255m([mwidget[00;38;05;255m->[mtag [00;38;05;255m==[m HSPC [00;38;05;255m||[m widget[00;38;05;255m->[mtag [00;38;05;255m==[m DRAW[00;38;05;255m);[m
      [00;38;05;75mbreak[m[00;38;05;255m;[m
    [00;38;05;196m}[m
  [00;38;05;75mreturn[m [00;38;05;255mmin[m[00;38;05;255m([mh[00;38;05;255m,[m context[00;38;05;255m.[mh[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mcontextSetViewport[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mSDL_Rect[m rect[00;38;05;255m;[m
  rect[00;38;05;255m.[mx [00;38;05;255m=[m context[00;38;05;255m.[mx[00;38;05;255m;[m
  rect[00;38;05;255m.[my [00;38;05;255m=[m context[00;38;05;255m.[my[00;38;05;255m;[m
  rect[00;38;05;255m.[mw [00;38;05;255m=[m context[00;38;05;255m.[mw[00;38;05;255m;[m
  rect[00;38;05;255m.[mh [00;38;05;255m=[m context[00;38;05;255m.[mh[00;38;05;255m;[m
  [00;38;05;255msetViewport[m[00;38;05;255m(&[mrect[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mint[m [00;38;05;255mcolumnToX[m[00;38;05;255m([m[00;38;05;255mint[m column[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m column [00;38;05;255m*[m st[00;38;05;255m.[mfont[00;38;05;255m.[mcharSkip[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mint[m [00;38;05;255mrowToY[m[00;38;05;255m([m[00;38;05;255mint[m row[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m row [00;38;05;255m*[m st[00;38;05;255m.[mfont[00;38;05;255m.[mlineSkip [00;38;05;255m+[m context[00;38;05;255m.[mdy[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mdrawCursor[m[00;38;05;255m([m[00;38;05;255mview_t[m [00;38;05;255m*[mview[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mint[m x [00;38;05;255m=[m [00;38;05;255mcolumnToX[m[00;38;05;255m([mview[00;38;05;255m->[mcursor[00;38;05;255m.[mcolumn[00;38;05;255m);[m
  [00;38;05;255mint[m y [00;38;05;255m=[m [00;38;05;255mrowToY[m[00;38;05;255m([mview[00;38;05;255m->[mcursor[00;38;05;255m.[mrow[00;38;05;255m);[m

  [00;38;05;75mif[m [00;38;05;255m([mview[00;38;05;255m->[mmode [00;38;05;255m==[m NAVIGATE_MODE[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255msetDrawColor[m[00;38;05;255m([mCURSOR_BACKGROUND_COLOR[00;38;05;255m);[m
      [00;38;05;255mfillRectAt[m[00;38;05;255m([mx[00;38;05;255m,[m y[00;38;05;255m,[m st[00;38;05;255m.[mfont[00;38;05;255m.[mcharSkip[00;38;05;255m,[m st[00;38;05;255m.[mfont[00;38;05;255m.[mlineSkip[00;38;05;255m);[m
    [00;38;05;196m}[m

  [00;38;05;255msetDrawColor[m[00;38;05;255m([mCURSOR_COLOR[00;38;05;255m);[m
  [00;38;05;255mfillRectAt[m[00;38;05;255m([mx[00;38;05;255m,[m y[00;38;05;255m,[m CURSOR_WIDTH[00;38;05;255m,[m st[00;38;05;255m.[mfont[00;38;05;255m.[mlineSkip[00;38;05;255m);[m

  [00;38;05;255msetDrawColor[m[00;38;05;255m([mcontext[00;38;05;255m.[mcolor[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mint[m [00;38;05;255mdistanceToEOL[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mchar[m [00;38;05;255m*[mp [00;38;05;255m=[m s[00;38;05;255m;[m
  [00;38;05;255mchar[m c [00;38;05;255m=[m [00;38;05;255m*[mp[00;38;05;255m;[m

  [00;38;05;75mwhile[m[00;38;05;255m([mc [00;38;05;255m!=[m [00;38;05;196m'[m[00;38;05;255m\n[m[00;38;05;196m'[m [00;38;05;255m&&[m c [00;38;05;255m!=[m [00;38;05;196m'[m[00;38;05;255m\0[m[00;38;05;196m'[m[00;38;05;255m)[m
    [00;38;05;196m{[m
      p[00;38;05;255m++;[m
      c [00;38;05;255m=[m [00;38;05;255m*[mp[00;38;05;255m;[m
    [00;38;05;196m}[m
  [00;38;05;75mreturn[m p [00;38;05;255m-[m s[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mint[m [00;38;05;255mdistanceToNextSpace[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms0[00;38;05;255m,[m [00;38;05;255mchar[m [00;38;05;255m*[mt[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mchar[m [00;38;05;255m*[ms [00;38;05;255m=[m s0[00;38;05;255m;[m
  [00;38;05;255mchar[m c [00;38;05;255m=[m [00;38;05;255m*[ms[00;38;05;255m;[m

  [00;38;05;75mwhile[m[00;38;05;255m([ms [00;38;05;255m<[m t[00;38;05;255m)[m
    [00;38;05;196m{[m
      s[00;38;05;255m++;[m
      c [00;38;05;255m=[m [00;38;05;255m*[ms[00;38;05;255m;[m
      [00;38;05;75mif[m [00;38;05;255m([mc [00;38;05;255m==[m [00;38;05;196m' '[m [00;38;05;255m||[m c [00;38;05;255m==[m [00;38;05;196m'[m[00;38;05;255m\n[m[00;38;05;196m'[m[00;38;05;255m)[m
        [00;38;05;196m{[m
          [00;38;05;75mwhile[m[00;38;05;255m([ms [00;38;05;255m<[m t[00;38;05;255m)[m
            [00;38;05;196m{[m
              s[00;38;05;255m++;[m
              c [00;38;05;255m=[m [00;38;05;255m*[ms[00;38;05;255m;[m
              [00;38;05;75mif[m [00;38;05;255m([mc [00;38;05;255m!=[m [00;38;05;196m' '[m [00;38;05;255m&&[m c [00;38;05;255m!=[m [00;38;05;196m'[m[00;38;05;255m\n[m[00;38;05;196m'[m[00;38;05;255m)[m [00;38;05;75mreturn[m s [00;38;05;255m-[m s0[00;38;05;255m;[m
            [00;38;05;196m}[m
          [00;38;05;75mreturn[m s [00;38;05;255m-[m s0[00;38;05;255m;[m
        [00;38;05;196m}[m
    [00;38;05;196m}[m

  [00;38;05;75mreturn[m s [00;38;05;255m-[m s0[00;38;05;255m;[m
[00;38;05;196m}[m
[00;38;05;255mint[m [00;38;05;255mdistanceToIndent[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[mp0[00;38;05;255m,[m [00;38;05;255mchar[m [00;38;05;255m*[mq[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mchar[m [00;38;05;255m*[mp [00;38;05;255m=[m p0[00;38;05;255m;[m
  [00;38;05;75mwhile[m[00;38;05;255m([mp [00;38;05;255m<[m q [00;38;05;255m&&[m [00;38;05;255m*[mp [00;38;05;255m==[m [00;38;05;196m' '[m[00;38;05;255m)[m
    [00;38;05;196m{[m
      p[00;38;05;255m++;[m
    [00;38;05;196m}[m
  [00;38;05;75mreturn[m p [00;38;05;255m-[m p0[00;38;05;255m;[m
[00;38;05;196m}[m
[00;38;05;255mint[m [00;38;05;255mdistanceToPrevSpace[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[mt[00;38;05;255m,[m [00;38;05;255mchar[m [00;38;05;255m*[ms0[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mchar[m [00;38;05;255m*[ms [00;38;05;255m=[m s0[00;38;05;255m;[m
  [00;38;05;255mchar[m c [00;38;05;255m=[m [00;38;05;255m*[ms[00;38;05;255m;[m

  [00;38;05;75mwhile[m[00;38;05;255m([ms [00;38;05;255m>[m t[00;38;05;255m)[m
    [00;38;05;196m{[m
      s[00;38;05;255m--;[m
      c [00;38;05;255m=[m [00;38;05;255m*[ms[00;38;05;255m;[m
      [00;38;05;75mif[m [00;38;05;255m([mc [00;38;05;255m==[m [00;38;05;196m' '[m [00;38;05;255m||[m c [00;38;05;255m==[m [00;38;05;196m'[m[00;38;05;255m\n[m[00;38;05;196m'[m[00;38;05;255m)[m
        [00;38;05;196m{[m
          [00;38;05;75mwhile[m[00;38;05;255m([ms [00;38;05;255m>[m t[00;38;05;255m)[m
            [00;38;05;196m{[m
              s[00;38;05;255m--;[m
              c [00;38;05;255m=[m [00;38;05;255m*[ms[00;38;05;255m;[m
              [00;38;05;75mif[m [00;38;05;255m([mc [00;38;05;255m!=[m [00;38;05;196m' '[m [00;38;05;255m&&[m c [00;38;05;255m!=[m [00;38;05;196m'[m[00;38;05;255m\n[m[00;38;05;196m'[m[00;38;05;255m)[m [00;38;05;75mreturn[m s [00;38;05;255m-[m s0[00;38;05;255m;[m
            [00;38;05;196m}[m
          [00;38;05;75mreturn[m s [00;38;05;255m-[m s0[00;38;05;255m;[m
        [00;38;05;196m}[m
    [00;38;05;196m}[m

  [00;38;05;75mreturn[m s [00;38;05;255m-[m s0[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mint[m [00;38;05;255mdistanceToStartOfElem[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m,[m [00;38;05;255mint[m offset[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mchar[m [00;38;05;255m*[mp0 [00;38;05;255m=[m s [00;38;05;255m+[m offset[00;38;05;255m;[m
  [00;38;05;255mchar[m [00;38;05;255m*[mp [00;38;05;255m=[m p0[00;38;05;255m;[m
  [00;38;05;75mif[m [00;38;05;255m([mp [00;38;05;255m>[m s [00;38;05;255m&&[m [00;38;05;255m*[mp [00;38;05;255m==[m [00;38;05;196m'[m[00;38;05;255m\n[m[00;38;05;196m'[m[00;38;05;255m)[m p[00;38;05;255m--;[m
  [00;38;05;75mif[m [00;38;05;255m([mp [00;38;05;255m>[m s [00;38;05;255m&&[m [00;38;05;255m*[mp [00;38;05;255m==[m [00;38;05;196m'[m[00;38;05;255m\0[m[00;38;05;196m'[m[00;38;05;255m)[m p[00;38;05;255m--;[m
  [00;38;05;75mwhile[m[00;38;05;255m([mp [00;38;05;255m>[m s[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;75mif[m [00;38;05;255m(*[mp [00;38;05;255m==[m [00;38;05;196m'[m[00;38;05;255m\0[m[00;38;05;196m'[m[00;38;05;255m)[m
        [00;38;05;196m{[m
          [00;38;05;75mreturn[m p [00;38;05;255m-[m p0 [00;38;05;255m+[m [00;38;05;171m2[m[00;38;05;255m;[m
        [00;38;05;196m}[m
      p[00;38;05;255m--;[m
    [00;38;05;196m}[m
  [00;38;05;75mreturn[m p [00;38;05;255m-[m p0[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mgetSelectionCoords[m[00;38;05;255m([m[00;38;05;255mview_t[m [00;38;05;255m*[mview[00;38;05;255m,[m [00;38;05;255mint[m [00;38;05;255m*[mcolumn[00;38;05;255m,[m [00;38;05;255mint[m [00;38;05;255m*[mrow[00;38;05;255m,[m [00;38;05;255mint[m [00;38;05;255m*[moffset[00;38;05;255m,[m [00;38;05;255mint[m [00;38;05;255m*[mlen[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;75mif[m[00;38;05;255m(![m[00;38;05;255mselectionActive[m[00;38;05;255m([mview[00;38;05;255m))[m
    [00;38;05;196m{[m
      [00;38;05;255m*[mcolumn [00;38;05;255m=[m view[00;38;05;255m->[mcursor[00;38;05;255m.[mcolumn[00;38;05;255m;[m
      [00;38;05;255m*[mrow [00;38;05;255m=[m view[00;38;05;255m->[mcursor[00;38;05;255m.[mrow[00;38;05;255m;[m
      [00;38;05;255m*[moffset [00;38;05;255m=[m view[00;38;05;255m->[mcursor[00;38;05;255m.[moffset[00;38;05;255m;[m
      [00;38;05;255m*[mlen [00;38;05;255m=[m [00;38;05;171m1[m[00;38;05;255m;[m
      [00;38;05;75mreturn[m[00;38;05;255m;[m
    [00;38;05;196m}[m

  [00;38;05;255mcursor_t[m [00;38;05;255m*[ma [00;38;05;255m=[m [00;38;05;255m&[mview[00;38;05;255m->[mcursor[00;38;05;255m;[m
  [00;38;05;255mcursor_t[m [00;38;05;255m*[mb [00;38;05;255m=[m [00;38;05;255m&[mview[00;38;05;255m->[mselection[00;38;05;255m;[m

  [00;38;05;75mif[m [00;38;05;255m([ma[00;38;05;255m->[moffset [00;38;05;255m>[m b[00;38;05;255m->[moffset[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255mswap[m[00;38;05;255m([mcursor_t[00;38;05;255m*,[m a[00;38;05;255m,[m b[00;38;05;255m);[m
    [00;38;05;196m}[m

  [00;38;05;255m*[moffset [00;38;05;255m=[m a[00;38;05;255m->[moffset[00;38;05;255m;[m
  [00;38;05;255m*[mlen [00;38;05;255m=[m b[00;38;05;255m->[moffset [00;38;05;255m-[m [00;38;05;255m*[moffset[00;38;05;255m;[m
  [00;38;05;255m*[mrow [00;38;05;255m=[m a[00;38;05;255m->[mrow[00;38;05;255m;[m
  [00;38;05;255m*[mcolumn [00;38;05;255m=[m a[00;38;05;255m->[mcolumn[00;38;05;255m;[m

  [00;38;05;255mchar[m [00;38;05;255m*[ms [00;38;05;255m=[m [00;38;05;255mdocOf[m[00;38;05;255m([mview[00;38;05;255m)->[mcontents[00;38;05;255m.[mstart[00;38;05;255m;[m

  [00;38;05;75mif[m[00;38;05;255m([mview[00;38;05;255m->[mselectMode [00;38;05;255m==[m LINE_SELECT[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255m*[mlen [00;38;05;255m+=[m [00;38;05;255mdistanceToEOL[m[00;38;05;255m([ms [00;38;05;255m+[m [00;38;05;255m*[moffset [00;38;05;255m+[m [00;38;05;255m*[mlen[00;38;05;255m);[m
      [00;38;05;255m*[moffset [00;38;05;255m-=[m [00;38;05;255m*[mcolumn[00;38;05;255m;[m
      [00;38;05;255m*[mlen [00;38;05;255m+=[m [00;38;05;255m*[mcolumn[00;38;05;255m;[m
      [00;38;05;255m*[mcolumn [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m
    [00;38;05;196m}[m
  [00;38;05;255m*[mlen [00;38;05;255m+=[m [00;38;05;171m1[m[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mdrawSearch[m[00;38;05;255m([m[00;38;05;255mview_t[m [00;38;05;255m*[mview[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc [00;38;05;255m=[m [00;38;05;255mdocOf[m[00;38;05;255m([mview[00;38;05;255m);[m
  [00;38;05;255mchar[m [00;38;05;255m*[ms [00;38;05;255m=[m doc[00;38;05;255m->[mcontents[00;38;05;255m.[mstart[00;38;05;255m;[m

  [00;38;05;255msetDrawColor[m[00;38;05;255m([mSEARCH_COLOR[00;38;05;255m);[m

  [00;38;05;255msearchBuffer_t[m [00;38;05;255m*[mresults [00;38;05;255m=[m [00;38;05;255m&[mdoc[00;38;05;255m->[msearchResults[00;38;05;255m;[m

  [00;38;05;75mfor[m[00;38;05;255m([m[00;38;05;255mint[m i [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m i [00;38;05;255m<[m results[00;38;05;255m->[mnumElems[00;38;05;255m;[m [00;38;05;255m++[mi[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255mcursor_t[m c[00;38;05;255m;[m
      [00;38;05;255mint[m [00;38;05;255m*[moffset [00;38;05;255m=[m [00;38;05;255marrayElemAt[m[00;38;05;255m([mresults[00;38;05;255m,[m i[00;38;05;255m);[m
      [00;38;05;255mcursorSetOffset[m[00;38;05;255m(&[mc[00;38;05;255m,[m [00;38;05;255m*[moffset[00;38;05;255m,[m doc[00;38;05;255m);[m [00;38;05;255m// BAL: this is inefficient (it starts over every time)[m
      [00;38;05;255mdrawStringSelection[m[00;38;05;255m([m[00;38;05;255mcolumnToX[m[00;38;05;255m([mc[00;38;05;255m.[mcolumn[00;38;05;255m),[m [00;38;05;255mrowToY[m[00;38;05;255m([mc[00;38;05;255m.[mrow[00;38;05;255m),[m s [00;38;05;255m+[m [00;38;05;255m*[moffset[00;38;05;255m,[m st[00;38;05;255m.[msearchLen[00;38;05;255m);[m
    [00;38;05;196m}[m

  [00;38;05;255msetDrawColor[m[00;38;05;255m([mcontext[00;38;05;255m.[mcolor[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mdrawSelection[m[00;38;05;255m([m[00;38;05;255mview_t[m [00;38;05;255m*[mview[00;38;05;255m)[m
[00;38;05;196m{[m

  [00;38;05;255mint[m offset[00;38;05;255m;[m
  [00;38;05;255mint[m len[00;38;05;255m;[m
  [00;38;05;255mint[m column[00;38;05;255m;[m
  [00;38;05;255mint[m row[00;38;05;255m;[m
  [00;38;05;255mchar[m [00;38;05;255m*[ms [00;38;05;255m=[m [00;38;05;255mdocOf[m[00;38;05;255m([mview[00;38;05;255m)->[mcontents[00;38;05;255m.[mstart[00;38;05;255m;[m

  [00;38;05;255msetDrawColor[m[00;38;05;255m([mSELECTION_COLOR[00;38;05;255m);[m

  [00;38;05;255mgetSelectionCoords[m[00;38;05;255m([mview[00;38;05;255m,[m [00;38;05;255m&[mcolumn[00;38;05;255m,[m [00;38;05;255m&[mrow[00;38;05;255m,[m [00;38;05;255m&[moffset[00;38;05;255m,[m [00;38;05;255m&[mlen[00;38;05;255m);[m

  [00;38;05;255mdrawStringSelection[m[00;38;05;255m([m[00;38;05;255mcolumnToX[m[00;38;05;255m([mcolumn[00;38;05;255m),[m [00;38;05;255mrowToY[m[00;38;05;255m([mrow[00;38;05;255m),[m s [00;38;05;255m+[m offset[00;38;05;255m,[m len[00;38;05;255m);[m

  [00;38;05;255msetDrawColor[m[00;38;05;255m([mcontext[00;38;05;255m.[mcolor[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mbool[m [00;38;05;255mcursorEq[m[00;38;05;255m([m[00;38;05;255mcursor_t[m [00;38;05;255m*[ma[00;38;05;255m,[m [00;38;05;255mcursor_t[m [00;38;05;255m*[mb[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m [00;38;05;255m([ma[00;38;05;255m->[mrow [00;38;05;255m==[m b[00;38;05;255m->[mrow [00;38;05;255m&&[m a[00;38;05;255m->[mcolumn [00;38;05;255m==[m b[00;38;05;255m->[mcolumn[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mbool[m [00;38;05;255msearchActive[m[00;38;05;255m([m[00;38;05;255mframe_t[m [00;38;05;255m*[mframe[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255m// if the doc in the builtins frame is searches[m
  [00;38;05;255m// and this isn't the searches view[m
  [00;38;05;75mreturn[m [00;38;05;255mframeOf[m[00;38;05;255m([mBUILTINS_FRAME[00;38;05;255m)->[mviews[00;38;05;255m.[moffset [00;38;05;255m==[m SEARCH_BUF [00;38;05;255m&&[m
         frame[00;38;05;255m->[mviews[00;38;05;255m.[moffset [00;38;05;255m!=[m SEARCH_BUF[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mdrawCursorOrSelection[m[00;38;05;255m([m[00;38;05;255mframe_t[m [00;38;05;255m*[mframe[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mview_t[m [00;38;05;255m*[mview [00;38;05;255m=[m [00;38;05;255mviewOf[m[00;38;05;255m([mframe[00;38;05;255m);[m
  [00;38;05;75mif[m [00;38;05;255m([m[00;38;05;255msearchActive[m[00;38;05;255m([mframe[00;38;05;255m))[m
    [00;38;05;196m{[m
      [00;38;05;255mdrawSearch[m[00;38;05;255m([mview[00;38;05;255m);[m
      [00;38;05;75mreturn[m[00;38;05;255m;[m
    [00;38;05;196m}[m
  [00;38;05;75mif[m [00;38;05;255m([m[00;38;05;255mselectionActive[m[00;38;05;255m([mview[00;38;05;255m))[m
    [00;38;05;196m{[m
      [00;38;05;255mdrawSelection[m[00;38;05;255m([mview[00;38;05;255m);[m
      [00;38;05;75mreturn[m[00;38;05;255m;[m
    [00;38;05;196m}[m
  [00;38;05;255mdrawCursor[m[00;38;05;255m([mview[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mwidgetAt[m[00;38;05;255m([m[00;38;05;255mwidget_t[m [00;38;05;255m*[mwidget[00;38;05;255m,[m [00;38;05;255mint[m x[00;38;05;255m,[m [00;38;05;255mint[m y[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255massert[m[00;38;05;255m([mcontext[00;38;05;255m.[mw [00;38;05;255m>=[m [00;38;05;171m0[m[00;38;05;255m);[m
  [00;38;05;255massert[m[00;38;05;255m([mcontext[00;38;05;255m.[mh [00;38;05;255m>=[m [00;38;05;171m0[m[00;38;05;255m);[m

  [00;38;05;75mif[m [00;38;05;255m([mx [00;38;05;255m>=[m context[00;38;05;255m.[mw [00;38;05;255m||[m y [00;38;05;255m>=[m context[00;38;05;255m.[mh[00;38;05;255m)[m
    [00;38;05;196m{[m
      context[00;38;05;255m.[mwid [00;38;05;255m=[m [00;38;05;255m-[m[00;38;05;171m1[m[00;38;05;255m;[m
      [00;38;05;75mreturn[m[00;38;05;255m;[m
    [00;38;05;196m}[m

  [00;38;05;75mswitch[m [00;38;05;255m([mwidget[00;38;05;255m->[mtag[00;38;05;255m)[m [00;38;05;196m{[m
  [00;38;05;75mcase[m HCAT[00;38;05;255m:[m [00;38;05;196m{[m
    [00;38;05;255mint[m w [00;38;05;255m=[m [00;38;05;255mwidgetWidth[m[00;38;05;255m([mwidget[00;38;05;255m->[ma[00;38;05;255m.[mchild[00;38;05;255m);[m
    [00;38;05;75mif[m [00;38;05;255m([mx [00;38;05;255m<[m w[00;38;05;255m)[m [00;38;05;196m{[m
      context[00;38;05;255m.[mw [00;38;05;255m=[m w[00;38;05;255m;[m
      [00;38;05;255mwidgetAt[m[00;38;05;255m([mwidget[00;38;05;255m->[ma[00;38;05;255m.[mchild[00;38;05;255m,[m x[00;38;05;255m,[m y[00;38;05;255m);[m
      [00;38;05;75mreturn[m[00;38;05;255m;[m
    [00;38;05;196m}[m
    context[00;38;05;255m.[mw [00;38;05;255m=[m context[00;38;05;255m.[mw [00;38;05;255m-[m w[00;38;05;255m;[m
    context[00;38;05;255m.[mx [00;38;05;255m+=[m w[00;38;05;255m;[m
    [00;38;05;255mwidgetAt[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m,[m x [00;38;05;255m-[m w[00;38;05;255m,[m y[00;38;05;255m);[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m
  [00;38;05;75mcase[m HCATR[00;38;05;255m:[m [00;38;05;196m{[m
    [00;38;05;255mint[m w [00;38;05;255m=[m context[00;38;05;255m.[mw [00;38;05;255m-[m [00;38;05;255mwidgetWidth[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m);[m
    [00;38;05;75mif[m [00;38;05;255m([mcontext[00;38;05;255m.[mx [00;38;05;255m<[m w[00;38;05;255m)[m [00;38;05;196m{[m
      context[00;38;05;255m.[mw [00;38;05;255m=[m w[00;38;05;255m;[m
      [00;38;05;255mwidgetAt[m[00;38;05;255m([mwidget[00;38;05;255m->[ma[00;38;05;255m.[mchild[00;38;05;255m,[m x[00;38;05;255m,[m y[00;38;05;255m);[m
      [00;38;05;75mreturn[m[00;38;05;255m;[m
    [00;38;05;196m}[m
    context[00;38;05;255m.[mw [00;38;05;255m=[m context[00;38;05;255m.[mw [00;38;05;255m-[m w[00;38;05;255m;[m
    context[00;38;05;255m.[mx [00;38;05;255m+=[m w[00;38;05;255m;[m
    [00;38;05;255mwidgetAt[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m,[m x [00;38;05;255m-[m w[00;38;05;255m,[m y[00;38;05;255m);[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m
  [00;38;05;75mcase[m VCAT[00;38;05;255m:[m [00;38;05;196m{[m
    [00;38;05;255mint[m h [00;38;05;255m=[m [00;38;05;255mwidgetHeight[m[00;38;05;255m([mwidget[00;38;05;255m->[ma[00;38;05;255m.[mchild[00;38;05;255m);[m
    [00;38;05;75mif[m [00;38;05;255m([mcontext[00;38;05;255m.[my [00;38;05;255m<[m h[00;38;05;255m)[m [00;38;05;196m{[m
      context[00;38;05;255m.[mh [00;38;05;255m=[m h[00;38;05;255m;[m
      [00;38;05;255mwidgetAt[m[00;38;05;255m([mwidget[00;38;05;255m->[ma[00;38;05;255m.[mchild[00;38;05;255m,[m x[00;38;05;255m,[m y[00;38;05;255m);[m
      [00;38;05;75mreturn[m[00;38;05;255m;[m
    [00;38;05;196m}[m
    context[00;38;05;255m.[mh [00;38;05;255m=[m context[00;38;05;255m.[mh [00;38;05;255m-[m h[00;38;05;255m;[m
    context[00;38;05;255m.[my [00;38;05;255m+=[m h[00;38;05;255m;[m
    [00;38;05;255mwidgetAt[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m,[m x[00;38;05;255m,[m y [00;38;05;255m-[m h[00;38;05;255m);[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m
  [00;38;05;75mcase[m VCATR[00;38;05;255m:[m [00;38;05;196m{[m
    [00;38;05;255mint[m h [00;38;05;255m=[m context[00;38;05;255m.[mh [00;38;05;255m-[m [00;38;05;255mwidgetHeight[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m);[m
    [00;38;05;75mif[m [00;38;05;255m([mcontext[00;38;05;255m.[my [00;38;05;255m<[m h[00;38;05;255m)[m [00;38;05;196m{[m
      context[00;38;05;255m.[mh [00;38;05;255m=[m h[00;38;05;255m;[m
      [00;38;05;255mwidgetAt[m[00;38;05;255m([mwidget[00;38;05;255m->[ma[00;38;05;255m.[mchild[00;38;05;255m,[m x[00;38;05;255m,[m y[00;38;05;255m);[m
      [00;38;05;75mreturn[m[00;38;05;255m;[m
    [00;38;05;196m}[m
    context[00;38;05;255m.[mh [00;38;05;255m=[m context[00;38;05;255m.[mh [00;38;05;255m-[m h[00;38;05;255m;[m
    context[00;38;05;255m.[my [00;38;05;255m+=[m h[00;38;05;255m;[m
    [00;38;05;255mwidgetAt[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m,[m x[00;38;05;255m,[m y [00;38;05;255m-[m h[00;38;05;255m);[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m
  [00;38;05;75mcase[m OVER[00;38;05;255m:[m
    [00;38;05;255mwidgetAt[m[00;38;05;255m([mwidget[00;38;05;255m->[ma[00;38;05;255m.[mchild[00;38;05;255m,[m x[00;38;05;255m,[m y[00;38;05;255m);[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;75mcase[m WID[00;38;05;255m:[m
    context[00;38;05;255m.[mwid [00;38;05;255m=[m widget[00;38;05;255m->[ma[00;38;05;255m.[mwid[00;38;05;255m;[m
    [00;38;05;255mwidgetAt[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m,[m x[00;38;05;255m,[m y[00;38;05;255m);[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;75mcase[m COLOR[00;38;05;255m:[m [00;38;05;255m// fall through[m
  [00;38;05;75mcase[m FONT[00;38;05;255m:[m [00;38;05;255m// fall through[m
    [00;38;05;255mwidgetAt[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m,[m x[00;38;05;255m,[m y[00;38;05;255m);[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;75mcase[m SCROLL_Y[00;38;05;255m:[m [00;38;05;196m{[m
    [00;38;05;255mint[m dy [00;38;05;255m=[m widget[00;38;05;255m->[ma[00;38;05;255m.[m[00;38;05;255mscrollYFun[m[00;38;05;255m([mwidget[00;38;05;255m->[mc[00;38;05;255m.[mdata[00;38;05;255m);[m
    context[00;38;05;255m.[my [00;38;05;255m+=[m dy[00;38;05;255m;[m
    [00;38;05;255mwidgetAt[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m,[m x[00;38;05;255m,[m y [00;38;05;255m+[m dy[00;38;05;255m);[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m
[00;38;05;255m  default:[m
    [00;38;05;255massert[m[00;38;05;255m([mwidget[00;38;05;255m->[mtag [00;38;05;255m==[m VSPC [00;38;05;255m||[m widget[00;38;05;255m->[mtag [00;38;05;255m==[m HSPC [00;38;05;255m||[m widget[00;38;05;255m->[mtag [00;38;05;255m==[m DRAW[00;38;05;255m);[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m
[00;38;05;196m}[m
[00;38;05;255mvoid[m [00;38;05;255mwidgetDraw[m[00;38;05;255m([m[00;38;05;255mwidget_t[m [00;38;05;255m*[mwidget[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;75mswitch[m [00;38;05;255m([mwidget[00;38;05;255m->[mtag[00;38;05;255m)[m [00;38;05;196m{[m
  [00;38;05;75mcase[m HCAT[00;38;05;255m:[m [00;38;05;196m{[m
    [00;38;05;255mint[m x [00;38;05;255m=[m context[00;38;05;255m.[mx[00;38;05;255m;[m
    [00;38;05;255mint[m w [00;38;05;255m=[m context[00;38;05;255m.[mw[00;38;05;255m;[m
    [00;38;05;255mint[m wa [00;38;05;255m=[m [00;38;05;255mwidgetWidth[m[00;38;05;255m([mwidget[00;38;05;255m->[ma[00;38;05;255m.[mchild[00;38;05;255m);[m

    context[00;38;05;255m.[mx [00;38;05;255m+=[m wa[00;38;05;255m;[m
    context[00;38;05;255m.[mw [00;38;05;255m=[m context[00;38;05;255m.[mw [00;38;05;255m-[m wa[00;38;05;255m;[m
    [00;38;05;255mcontextSetViewport[m[00;38;05;255m();[m
    [00;38;05;255mwidgetDraw[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m);[m

    context[00;38;05;255m.[mx [00;38;05;255m=[m x[00;38;05;255m;[m
    context[00;38;05;255m.[mw [00;38;05;255m=[m wa[00;38;05;255m;[m
    [00;38;05;255mcontextSetViewport[m[00;38;05;255m();[m
    [00;38;05;255mwidgetDraw[m[00;38;05;255m([mwidget[00;38;05;255m->[ma[00;38;05;255m.[mchild[00;38;05;255m);[m

    context[00;38;05;255m.[mw [00;38;05;255m=[m w[00;38;05;255m;[m
    [00;38;05;255mcontextSetViewport[m[00;38;05;255m();[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m
  [00;38;05;75mcase[m HCATR[00;38;05;255m:[m [00;38;05;196m{[m
    [00;38;05;255mint[m x [00;38;05;255m=[m context[00;38;05;255m.[mx[00;38;05;255m;[m
    [00;38;05;255mint[m w [00;38;05;255m=[m context[00;38;05;255m.[mw[00;38;05;255m;[m

    context[00;38;05;255m.[mw [00;38;05;255m=[m context[00;38;05;255m.[mw [00;38;05;255m-[m [00;38;05;255mwidgetWidth[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m);[m
    [00;38;05;255mcontextSetViewport[m[00;38;05;255m();[m
    [00;38;05;255mwidgetDraw[m[00;38;05;255m([mwidget[00;38;05;255m->[ma[00;38;05;255m.[mchild[00;38;05;255m);[m

    context[00;38;05;255m.[mx [00;38;05;255m+=[m context[00;38;05;255m.[mw[00;38;05;255m;[m
    context[00;38;05;255m.[mw [00;38;05;255m=[m w [00;38;05;255m-[m context[00;38;05;255m.[mw[00;38;05;255m;[m
    [00;38;05;255mcontextSetViewport[m[00;38;05;255m();[m
    [00;38;05;255mwidgetDraw[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m);[m

    context[00;38;05;255m.[mx [00;38;05;255m=[m x[00;38;05;255m;[m
    context[00;38;05;255m.[mw [00;38;05;255m=[m w[00;38;05;255m;[m
    [00;38;05;255mcontextSetViewport[m[00;38;05;255m();[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m
  [00;38;05;75mcase[m VCAT[00;38;05;255m:[m [00;38;05;196m{[m
    [00;38;05;255mint[m y [00;38;05;255m=[m context[00;38;05;255m.[my[00;38;05;255m;[m
    [00;38;05;255mint[m h [00;38;05;255m=[m context[00;38;05;255m.[mh[00;38;05;255m;[m

    context[00;38;05;255m.[mh [00;38;05;255m=[m [00;38;05;255mwidgetHeight[m[00;38;05;255m([mwidget[00;38;05;255m->[ma[00;38;05;255m.[mchild[00;38;05;255m);[m
    [00;38;05;255mcontextSetViewport[m[00;38;05;255m();[m
    [00;38;05;255mwidgetDraw[m[00;38;05;255m([mwidget[00;38;05;255m->[ma[00;38;05;255m.[mchild[00;38;05;255m);[m

    context[00;38;05;255m.[my [00;38;05;255m+=[m context[00;38;05;255m.[mh[00;38;05;255m;[m
    context[00;38;05;255m.[mh [00;38;05;255m=[m h [00;38;05;255m-[m context[00;38;05;255m.[mh[00;38;05;255m;[m
    [00;38;05;255mcontextSetViewport[m[00;38;05;255m();[m
    [00;38;05;255mwidgetDraw[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m);[m

    context[00;38;05;255m.[mh [00;38;05;255m=[m h[00;38;05;255m;[m
    context[00;38;05;255m.[my [00;38;05;255m=[m y[00;38;05;255m;[m
    [00;38;05;255mcontextSetViewport[m[00;38;05;255m();[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m
  [00;38;05;75mcase[m VCATR[00;38;05;255m:[m [00;38;05;196m{[m
    [00;38;05;255mint[m y [00;38;05;255m=[m context[00;38;05;255m.[my[00;38;05;255m;[m
    [00;38;05;255mint[m h [00;38;05;255m=[m context[00;38;05;255m.[mh[00;38;05;255m;[m

    context[00;38;05;255m.[mh [00;38;05;255m=[m context[00;38;05;255m.[mh [00;38;05;255m-[m [00;38;05;255mwidgetHeight[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m);[m
    [00;38;05;255mcontextSetViewport[m[00;38;05;255m();[m
    [00;38;05;255mwidgetDraw[m[00;38;05;255m([mwidget[00;38;05;255m->[ma[00;38;05;255m.[mchild[00;38;05;255m);[m

    context[00;38;05;255m.[my [00;38;05;255m+=[m context[00;38;05;255m.[mh[00;38;05;255m;[m
    context[00;38;05;255m.[mh [00;38;05;255m=[m h [00;38;05;255m-[m context[00;38;05;255m.[mh[00;38;05;255m;[m
    [00;38;05;255mcontextSetViewport[m[00;38;05;255m();[m
    [00;38;05;255mwidgetDraw[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m);[m

    context[00;38;05;255m.[mh [00;38;05;255m=[m h[00;38;05;255m;[m
    context[00;38;05;255m.[my [00;38;05;255m=[m y[00;38;05;255m;[m
    [00;38;05;255mcontextSetViewport[m[00;38;05;255m();[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m
  [00;38;05;75mcase[m OVER[00;38;05;255m:[m [00;38;05;196m{[m
    [00;38;05;255mwidgetDraw[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m);[m
    [00;38;05;255mwidgetDraw[m[00;38;05;255m([mwidget[00;38;05;255m->[ma[00;38;05;255m.[mchild[00;38;05;255m);[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m
  [00;38;05;75mcase[m SCROLL_Y[00;38;05;255m:[m [00;38;05;196m{[m
    [00;38;05;255mint[m dy [00;38;05;255m=[m context[00;38;05;255m.[mdy[00;38;05;255m;[m
    context[00;38;05;255m.[mdy [00;38;05;255m+=[m widget[00;38;05;255m->[ma[00;38;05;255m.[m[00;38;05;255mscrollYFun[m[00;38;05;255m([mwidget[00;38;05;255m->[mc[00;38;05;255m.[mdata[00;38;05;255m);[m
    [00;38;05;255mwidgetDraw[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m);[m
    context[00;38;05;255m.[mdy [00;38;05;255m=[m dy[00;38;05;255m;[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m
  [00;38;05;75mcase[m FONT[00;38;05;255m:[m [00;38;05;196m{[m
    [00;38;05;255mfont_t[m [00;38;05;255m*[mfont [00;38;05;255m=[m context[00;38;05;255m.[mfont[00;38;05;255m;[m
    context[00;38;05;255m.[mfont [00;38;05;255m=[m [00;38;05;255m*[mwidget[00;38;05;255m->[ma[00;38;05;255m.[mfont[00;38;05;255m;[m
    [00;38;05;255mwidgetDraw[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m);[m
    context[00;38;05;255m.[mfont [00;38;05;255m=[m font[00;38;05;255m;[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m
  [00;38;05;75mcase[m WID[00;38;05;255m:[m
    [00;38;05;255mwidgetDraw[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m);[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;75mcase[m COLOR[00;38;05;255m:[m [00;38;05;196m{[m
    [00;38;05;255mint[m color [00;38;05;255m=[m context[00;38;05;255m.[mcolor[00;38;05;255m;[m
    context[00;38;05;255m.[mcolor [00;38;05;255m=[m [00;38;05;255m*[mwidget[00;38;05;255m->[ma[00;38;05;255m.[mcolor[00;38;05;255m;[m
    [00;38;05;255msetDrawColor[m[00;38;05;255m([mcontext[00;38;05;255m.[mcolor[00;38;05;255m);[m
    [00;38;05;255mwidgetDraw[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mchild[00;38;05;255m);[m
    context[00;38;05;255m.[mcolor [00;38;05;255m=[m color[00;38;05;255m;[m
    [00;38;05;255msetDrawColor[m[00;38;05;255m([mcontext[00;38;05;255m.[mcolor[00;38;05;255m);[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m
  [00;38;05;75mcase[m DRAW[00;38;05;255m:[m
    widget[00;38;05;255m->[ma[00;38;05;255m.[m[00;38;05;255mdrawFun[m[00;38;05;255m([mwidget[00;38;05;255m->[mb[00;38;05;255m.[mdata[00;38;05;255m);[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
[00;38;05;255m  default:[m
    [00;38;05;255massert[m[00;38;05;255m([mwidget[00;38;05;255m->[mtag [00;38;05;255m==[m VSPC [00;38;05;255m||[m widget[00;38;05;255m->[mtag [00;38;05;255m==[m HSPC[00;38;05;255m);[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mcontextReinit[m[00;38;05;255m()[m
[00;38;05;196m{[m
  context[00;38;05;255m.[mx [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m
  context[00;38;05;255m.[my [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m
  context[00;38;05;255m.[mcolor [00;38;05;255m=[m [00;38;05;171m0xffffffff[m[00;38;05;255m;[m
  context[00;38;05;255m.[mfont [00;38;05;255m=[m [00;38;05;255m&[mst[00;38;05;255m.[mfont[00;38;05;255m;[m
  context[00;38;05;255m.[mw [00;38;05;255m=[m st[00;38;05;255m.[mwindow[00;38;05;255m.[mwidth[00;38;05;255m;[m
  context[00;38;05;255m.[mh [00;38;05;255m=[m st[00;38;05;255m.[mwindow[00;38;05;255m.[mheight[00;38;05;255m;[m
  context[00;38;05;255m.[mdy [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m
  context[00;38;05;255m.[mwid [00;38;05;255m=[m [00;38;05;255m-[m[00;38;05;171m1[m[00;38;05;255m;[m
  [00;38;05;255mSDL_Rect[m rect[00;38;05;255m;[m
  rect[00;38;05;255m.[mx [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m
  rect[00;38;05;255m.[my [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m
  rect[00;38;05;255m.[mw [00;38;05;255m=[m context[00;38;05;255m.[mw[00;38;05;255m;[m
  rect[00;38;05;255m.[mh [00;38;05;255m=[m context[00;38;05;255m.[mh[00;38;05;255m;[m
  [00;38;05;255msetViewport[m[00;38;05;255m(&[mrect[00;38;05;255m);[m
  [00;38;05;255msetDrawColor[m[00;38;05;255m([mcontext[00;38;05;255m.[mcolor[00;38;05;255m);[m
[00;38;05;196m}[m
[00;38;05;255mvoid[m [00;38;05;255mstDraw[m[00;38;05;255m([m[00;38;05;255mvoid[m[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255msetDrawColor[m[00;38;05;255m([m[00;38;05;171m0x00ff00ff[m[00;38;05;255m);[m
  [00;38;05;255mrendererClear[m[00;38;05;255m();[m
  [00;38;05;255mcontextReinit[m[00;38;05;255m();[m
  [00;38;05;255mwidgetDraw[m[00;38;05;255m([mgui[00;38;05;255m);[m
  [00;38;05;255mrendererPresent[m[00;38;05;255m();[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mwindowInit[m[00;38;05;255m([m[00;38;05;255mwindow_t[m [00;38;05;255m*[mwin[00;38;05;255m,[m [00;38;05;255mint[m width[00;38;05;255m,[m [00;38;05;255mint[m height[00;38;05;255m)[m
[00;38;05;196m{[m
    win[00;38;05;255m->[mwindow [00;38;05;255m=[m [00;38;05;255mdieIfNull[m[00;38;05;255m([m[00;38;05;255mSDL_CreateWindow[m[00;38;05;255m([m[00;38;05;196m"Editor"[m[00;38;05;255m,[m [00;38;05;171m0[m[00;38;05;255m,[m [00;38;05;171m0[m[00;38;05;255m,[m width[00;38;05;255m,[m height[00;38;05;255m,[m SDL_WINDOW_RESIZABLE [00;38;05;255m|[m SDL_WINDOW_ALLOW_HIGHDPI[00;38;05;255m));[m

    win[00;38;05;255m->[mwidth [00;38;05;255m=[m width[00;38;05;255m;[m
    win[00;38;05;255m->[mheight [00;38;05;255m=[m height[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mframeResize[m[00;38;05;255m([m[00;38;05;255mframe_t[m [00;38;05;255m*[mframe[00;38;05;255m)[m
[00;38;05;196m{[m
  frame[00;38;05;255m->[mwidth [00;38;05;255m=[m st[00;38;05;255m.[mwindow[00;38;05;255m.[mwidth [00;38;05;255m/[m [00;38;05;171m3[m[00;38;05;255m;[m
  frame[00;38;05;255m->[mheight [00;38;05;255m=[m st[00;38;05;255m.[mwindow[00;38;05;255m.[mheight [00;38;05;255m-[m st[00;38;05;255m.[mfont[00;38;05;255m.[mlineSkip[00;38;05;255m;[m
[00;38;05;196m}[m
[00;38;05;255mvoid[m [00;38;05;255mmessage[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m);[m

[00;38;05;255mvoid[m [00;38;05;255mstResize[m[00;38;05;255m([m[00;38;05;255mvoid[m[00;38;05;255m)[m
[00;38;05;196m{[m
    [00;38;05;255mint[m w[00;38;05;255m;[m
    [00;38;05;255mint[m h[00;38;05;255m;[m

    [00;38;05;255mSDL_GetWindowSize[m[00;38;05;255m([mst[00;38;05;255m.[mwindow[00;38;05;255m.[mwindow[00;38;05;255m,[m [00;38;05;255m&[mw[00;38;05;255m,[m [00;38;05;255m&[mh[00;38;05;255m);[m
    st[00;38;05;255m.[mwindow[00;38;05;255m.[mwidth [00;38;05;255m=[m w[00;38;05;255m;[m
    st[00;38;05;255m.[mwindow[00;38;05;255m.[mheight [00;38;05;255m=[m h[00;38;05;255m;[m
    [00;38;05;75mfor[m[00;38;05;255m([m[00;38;05;255mint[m i [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m i [00;38;05;255m<[m [00;38;05;255mnumFrames[m[00;38;05;255m();[m [00;38;05;255m++[mi[00;38;05;255m)[m
      [00;38;05;196m{[m
        [00;38;05;255mframeResize[m[00;38;05;255m([m[00;38;05;255mframeOf[m[00;38;05;255m([mi[00;38;05;255m));[m
      [00;38;05;196m}[m
   [00;38;05;255mchar[m s[00;38;05;255m[[m[00;38;05;171m1024[m[00;38;05;255m];[m
   [00;38;05;255msprintf[m[00;38;05;255m([ms[00;38;05;255m,[m [00;38;05;196m"resize %dx%d"[m[00;38;05;255m,[m w[00;38;05;255m,[m h[00;38;05;255m);[m
   [00;38;05;255mmessage[m[00;38;05;255m([ms[00;38;05;255m);[m

[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255minsertNewElem[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mbackwardSOF[m[00;38;05;255m();[m
  [00;38;05;255mbuiltinInsertString[m[00;38;05;255m([m[00;38;05;196m"[m[00;38;05;255m\0\n[m[00;38;05;196m"[m[00;38;05;255m,[m [00;38;05;171m2[m[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255m// BAL: delete[m
[00;38;05;255m/* void buffersBufInit() */[m
[00;38;05;255m/* { */[m
[00;38;05;255m/*   setFocusView(BUFFERS_BUF); */[m

[00;38;05;255m/*   for(int i = 0; i < numViews(); ++i) */[m
[00;38;05;255m/*   { */[m
[00;38;05;255m/*     view_t *view = arrayElemAt(&st.views, i); */[m
[00;38;05;255m/*     insertNewElem(); */[m
[00;38;05;255m/*     builtinInsertCString(docOf(view)->filepath); */[m
[00;38;05;255m/*   } */[m
[00;38;05;255m/* } */[m

[00;38;05;255mvoid[m [00;38;05;255mdrawFrameCursor[m[00;38;05;255m([m[00;38;05;255mframe_t[m [00;38;05;255m*[mframe[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mdrawCursorOrSelection[m[00;38;05;255m([mframe[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mdrawFrameDoc[m[00;38;05;255m([m[00;38;05;255mframe_t[m [00;38;05;255m*[mframe[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mdrawString[m[00;38;05;255m(&[m[00;38;05;255mdocOf[m[00;38;05;255m([m[00;38;05;255mviewOf[m[00;38;05;255m([mframe[00;38;05;255m))->[mcontents[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mint[m [00;38;05;255mframeScrollY[m[00;38;05;255m([m[00;38;05;255mframe_t[m [00;38;05;255m*[mframe[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mview_t[m [00;38;05;255m*[mview [00;38;05;255m=[m [00;38;05;255mviewOf[m[00;38;05;255m([mframe[00;38;05;255m);[m
  [00;38;05;75mreturn[m view[00;38;05;255m->[mscrollY[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mwidget_t[m [00;38;05;255m*[m[00;38;05;255mframe[m[00;38;05;255m([m[00;38;05;255mint[m i[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mframe_t[m [00;38;05;255m*[mframe [00;38;05;255m=[m [00;38;05;255marrayElemAt[m[00;38;05;255m(&[mst[00;38;05;255m.[mframes[00;38;05;255m,[m i[00;38;05;255m);[m
  [00;38;05;255mwidget_t[m [00;38;05;255m*[mtextarea [00;38;05;255m=[m [00;38;05;255mwid[m[00;38;05;255m([mi[00;38;05;255m,[m [00;38;05;255mscrollY[m[00;38;05;255m([mframeScrollY[00;38;05;255m,[m frame[00;38;05;255m,[m [00;38;05;255mover[m[00;38;05;255m([m[00;38;05;255mdraw[m[00;38;05;255m([mdrawFrameDoc[00;38;05;255m,[m frame[00;38;05;255m),[m [00;38;05;255mdraw[m[00;38;05;255m([mdrawFrameCursor[00;38;05;255m,[m frame[00;38;05;255m))));[m
  [00;38;05;255mwidget_t[m [00;38;05;255m*[mstatus [00;38;05;255m=[m [00;38;05;255mover[m[00;38;05;255m([m[00;38;05;255mdraw[m[00;38;05;255m([mdrawString[00;38;05;255m,[m [00;38;05;255m&[mframe[00;38;05;255m->[mstatus[00;38;05;255m),[m [00;38;05;255mvspc[m[00;38;05;255m(&[mst[00;38;05;255m.[mfont[00;38;05;255m.[mlineSkip[00;38;05;255m));[m
  [00;38;05;255mwidget_t[m [00;38;05;255m*[mbackground [00;38;05;255m=[m [00;38;05;255mcolor[m[00;38;05;255m(&[mframe[00;38;05;255m->[mcolor[00;38;05;255m,[m [00;38;05;255mover[m[00;38;05;255m([m[00;38;05;255mbox[m[00;38;05;255m(),[m [00;38;05;255mhspc[m[00;38;05;255m(&[mframe[00;38;05;255m->[mwidth[00;38;05;255m)));[m
  [00;38;05;75mreturn[m [00;38;05;255mover[m[00;38;05;255m([m[00;38;05;255mvcatr[m[00;38;05;255m([mtextarea[00;38;05;255m,[m status[00;38;05;255m),[m background[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mmessage[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mint[m refFrame [00;38;05;255m=[m [00;38;05;255mfocusFrameRef[m[00;38;05;255m();[m
  [00;38;05;255msetFocusFrame[m[00;38;05;255m([mBUILTINS_FRAME[00;38;05;255m);[m
  [00;38;05;255msetFocusView[m[00;38;05;255m([mMESSAGE_BUF[00;38;05;255m);[m
  [00;38;05;255minsertNewElem[m[00;38;05;255m();[m
  [00;38;05;255mbuiltinInsertCString[m[00;38;05;255m([ms[00;38;05;255m);[m
  [00;38;05;255msetFocusFrame[m[00;38;05;255m([mrefFrame[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mhelpBufInit[m[00;38;05;255m([m[00;38;05;255mvoid[m[00;38;05;255m);[m

[00;38;05;255mvoid[m [00;38;05;255mstInit[m[00;38;05;255m([m[00;38;05;255mint[m argc[00;38;05;255m,[m [00;38;05;255mchar[m [00;38;05;255m**[margv[00;38;05;255m)[m
[00;38;05;196m{[m
  argc[00;38;05;255m--;[m
  argv[00;38;05;255m++;[m
  [00;38;05;255mmemset[m[00;38;05;255m(&[mst[00;38;05;255m,[m [00;38;05;171m0[m[00;38;05;255m,[m [00;38;05;75msizeof[m[00;38;05;255m([mstate_t[00;38;05;255m));[m

  [00;38;05;75mif[m [00;38;05;255m([m[00;38;05;255mSDL_Init[m[00;38;05;255m([mSDL_INIT_VIDEO [00;38;05;255m|[m SDL_INIT_TIMER[00;38;05;255m)[m [00;38;05;255m!=[m [00;38;05;171m0[m[00;38;05;255m)[m [00;38;05;255mdie[m[00;38;05;255m([m[00;38;05;255mSDL_GetError[m[00;38;05;255m());[m

  [00;38;05;255mwindowInit[m[00;38;05;255m(&[mst[00;38;05;255m.[mwindow[00;38;05;255m,[m INIT_WINDOW_WIDTH[00;38;05;255m,[m INIT_WINDOW_HEIGHT[00;38;05;255m);[m

  [00;38;05;255mrendererInit[m[00;38;05;255m([mst[00;38;05;255m.[mwindow[00;38;05;255m.[mwindow[00;38;05;255m);[m

  [00;38;05;255minitFont[m[00;38;05;255m(&[mst[00;38;05;255m.[mfont[00;38;05;255m,[m INIT_FONT_FILE[00;38;05;255m,[m INIT_FONT_SIZE[00;38;05;255m);[m

  [00;38;05;255minitMacros[m[00;38;05;255m();[m


    [00;38;05;255marrayInit[m[00;38;05;255m(&[mst[00;38;05;255m.[mdocs[00;38;05;255m,[m [00;38;05;75msizeof[m[00;38;05;255m([mdoc_t[00;38;05;255m));[m
    [00;38;05;255marrayInit[m[00;38;05;255m(&[mst[00;38;05;255m.[mframes[00;38;05;255m,[m [00;38;05;75msizeof[m[00;38;05;255m([mframe_t[00;38;05;255m));[m
    [00;38;05;255marrayInit[m[00;38;05;255m(&[mst[00;38;05;255m.[mreplace[00;38;05;255m,[m [00;38;05;75msizeof[m[00;38;05;255m([m[00;38;05;255mchar[m[00;38;05;255m));[m

    [00;38;05;255mkeysymInit[m[00;38;05;255m();[m

    [00;38;05;75mfor[m[00;38;05;255m([m[00;38;05;255mint[m i [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m i [00;38;05;255m<[m NUM_BUILTIN_BUFFERS[00;38;05;255m;[m [00;38;05;255m++[mi[00;38;05;255m)[m
      [00;38;05;196m{[m
        [00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc [00;38;05;255m=[m [00;38;05;255marrayPushUninit[m[00;38;05;255m(&[mst[00;38;05;255m.[mdocs[00;38;05;255m);[m
        [00;38;05;255mdocInit[m[00;38;05;255m([mdoc[00;38;05;255m,[m builtinBufferTitle[00;38;05;255m[[mi[00;38;05;255m],[m false[00;38;05;255m,[m builtinBufferReadOnly[00;38;05;255m[[mi[00;38;05;255m]);[m
      [00;38;05;196m}[m

    [00;38;05;75mfor[m[00;38;05;255m([m[00;38;05;255mint[m i [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m i [00;38;05;255m<[m argc[00;38;05;255m;[m [00;38;05;255m++[mi[00;38;05;255m)[m [00;38;05;196m{[m
      [00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc [00;38;05;255m=[m [00;38;05;255marrayPushUninit[m[00;38;05;255m(&[mst[00;38;05;255m.[mdocs[00;38;05;255m);[m
      [00;38;05;255mdocInit[m[00;38;05;255m([mdoc[00;38;05;255m,[m argv[00;38;05;255m[[mi[00;38;05;255m],[m true[00;38;05;255m,[m false[00;38;05;255m);[m
      [00;38;05;255mdocRead[m[00;38;05;255m([mdoc[00;38;05;255m);[m
    [00;38;05;196m}[m

    [00;38;05;75mfor[m[00;38;05;255m([m[00;38;05;255mint[m i [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m i [00;38;05;255m<[m NUM_FRAMES[00;38;05;255m;[m [00;38;05;255m++[mi[00;38;05;255m)[m
    [00;38;05;196m{[m
        [00;38;05;255mframe_t[m [00;38;05;255m*[mv [00;38;05;255m=[m [00;38;05;255marrayPushUninit[m[00;38;05;255m(&[mst[00;38;05;255m.[mframes[00;38;05;255m);[m
        [00;38;05;255mframeInit[m[00;38;05;255m([mv[00;38;05;255m);[m
        [00;38;05;75mif[m [00;38;05;255m([mi [00;38;05;255m==[m BUILTINS_FRAME[00;38;05;255m)[m
          [00;38;05;196m{[m
            [00;38;05;75mfor[m[00;38;05;255m([m[00;38;05;255mint[m j [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m j [00;38;05;255m<[m NUM_BUILTIN_BUFFERS[00;38;05;255m;[m [00;38;05;255m++[mj[00;38;05;255m)[m
              [00;38;05;196m{[m
                [00;38;05;255mviewInit[m[00;38;05;255m([m[00;38;05;255marrayPushUninit[m[00;38;05;255m(&[mv[00;38;05;255m->[mviews[00;38;05;255m),[m j[00;38;05;255m);[m
              [00;38;05;196m}[m
          [00;38;05;196m}[m
        [00;38;05;75melse[m
          [00;38;05;196m{[m
            [00;38;05;75mfor[m[00;38;05;255m([m[00;38;05;255mint[m j [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m j [00;38;05;255m<[m argc[00;38;05;255m;[m [00;38;05;255m++[mj[00;38;05;255m)[m
              [00;38;05;196m{[m
                [00;38;05;255mviewInit[m[00;38;05;255m([m[00;38;05;255marrayPushUninit[m[00;38;05;255m(&[mv[00;38;05;255m->[mviews[00;38;05;255m),[m NUM_BUILTIN_BUFFERS [00;38;05;255m+[m j[00;38;05;255m);[m
              [00;38;05;196m}[m
          [00;38;05;196m}[m
        [00;38;05;255msetFrameView[m[00;38;05;255m([mi[00;38;05;255m,[m [00;38;05;171m0[m[00;38;05;255m);[m
    [00;38;05;196m}[m

    [00;38;05;255msetFocusFrame[m[00;38;05;255m([mMAIN_FRAME[00;38;05;255m);[m

    gui [00;38;05;255m=[m [00;38;05;255mhcat[m[00;38;05;255m([m[00;38;05;255mframe[m[00;38;05;255m([m[00;38;05;171m0[m[00;38;05;255m),[m [00;38;05;255mhcat[m[00;38;05;255m([m[00;38;05;255mframe[m[00;38;05;255m([m[00;38;05;171m1[m[00;38;05;255m),[m [00;38;05;255mframe[m[00;38;05;255m([m[00;38;05;171m2[m[00;38;05;255m)));[m

    [00;38;05;255mmessage[m[00;38;05;255m([m[00;38;05;196m"hello from the beyond"[m[00;38;05;255m);[m

    [00;38;05;255mhelpBufInit[m[00;38;05;255m();[m

    [00;38;05;255mstResize[m[00;38;05;255m();[m

    [00;38;05;255m// BAL: buffersBufInit();[m


    [00;38;05;255m/* setFocusFrame(SECONDARY_FRAME); */[m
    [00;38;05;255m/* stSetViewFocus(MESSAGE_BUF); */[m
    [00;38;05;255m/* setFocusFrame(BUILTINS_FRAME); */[m
    [00;38;05;255m/* stSetViewFocus(BUFFERS_BUF); */[m
    [00;38;05;255m/* setFocusFrame(MAIN_FRAME); */[m
    [00;38;05;255m/* stSetViewFocus(NUM_BUILTIN_BUFFERS); */[m

[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mquitEvent[m[00;38;05;255m()[m
[00;38;05;196m{[m
    [00;38;05;75mfor[m[00;38;05;255m([m[00;38;05;255mint[m i [00;38;05;255m=[m NUM_BUILTIN_BUFFERS[00;38;05;255m;[m i [00;38;05;255m<[m st[00;38;05;255m.[mdocs[00;38;05;255m.[mnumElems[00;38;05;255m;[m [00;38;05;255m++[mi[00;38;05;255m)[m
    [00;38;05;196m{[m
        [00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc [00;38;05;255m=[m [00;38;05;255marrayElemAt[m[00;38;05;255m(&[mst[00;38;05;255m.[mdocs[00;38;05;255m,[m i[00;38;05;255m);[m
        [00;38;05;255massert[m[00;38;05;255m([mdoc[00;38;05;255m);[m
        [00;38;05;255mdocWrite[m[00;38;05;255m([mdoc[00;38;05;255m);[m
    [00;38;05;196m}[m
    [00;38;05;255mTTF_Quit[m[00;38;05;255m();[m
    [00;38;05;255mSDL_Quit[m[00;38;05;255m();[m
    [00;38;05;255mexit[m[00;38;05;255m([m[00;38;05;171m0[m[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mwindowEvent[m[00;38;05;255m()[m
[00;38;05;196m{[m
    [00;38;05;75mswitch[m [00;38;05;255m([mst[00;38;05;255m.[mevent[00;38;05;255m.[mwindow[00;38;05;255m.[mevent[00;38;05;255m)[m [00;38;05;196m{[m
        [00;38;05;75mcase[m SDL_WINDOWEVENT_SIZE_CHANGED[00;38;05;255m:[m
            [00;38;05;255mstResize[m[00;38;05;255m();[m
            [00;38;05;75mbreak[m[00;38;05;255m;[m
[00;38;05;255m        default:[m
            [00;38;05;75mbreak[m[00;38;05;255m;[m
    [00;38;05;196m}[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mselectChars[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mview_t[m [00;38;05;255m*[mview [00;38;05;255m=[m [00;38;05;255mfocusView[m[00;38;05;255m();[m
  [00;38;05;255mcursorCopy[m[00;38;05;255m(&[mview[00;38;05;255m->[mselection[00;38;05;255m,[m [00;38;05;255m&[mview[00;38;05;255m->[mcursor[00;38;05;255m);[m
  view[00;38;05;255m->[mselectMode [00;38;05;255m=[m CHAR_SELECT[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mselectLines[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mview_t[m [00;38;05;255m*[mview [00;38;05;255m=[m [00;38;05;255mfocusView[m[00;38;05;255m();[m
  [00;38;05;255mcursorCopy[m[00;38;05;255m(&[mview[00;38;05;255m->[mselection[00;38;05;255m,[m [00;38;05;255m&[mview[00;38;05;255m->[mcursor[00;38;05;255m);[m
  view[00;38;05;255m->[mselectMode [00;38;05;255m=[m LINE_SELECT[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mselectionCancel[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mview_t[m [00;38;05;255m*[mview [00;38;05;255m=[m [00;38;05;255mfocusView[m[00;38;05;255m();[m
  view[00;38;05;255m->[mselectMode [00;38;05;255m=[m NO_SELECT[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mint[m [00;38;05;255mdocHeight[m[00;38;05;255m([m[00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m doc[00;38;05;255m->[mnumLines [00;38;05;255m*[m st[00;38;05;255m.[mfont[00;38;05;255m.[mlineSkip[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mfocusScrollY[m[00;38;05;255m([m[00;38;05;255mint[m dR[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mframe_t[m [00;38;05;255m*[mframe [00;38;05;255m=[m [00;38;05;255mfocusFrame[m[00;38;05;255m();[m
  [00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc [00;38;05;255m=[m [00;38;05;255mfocusDoc[m[00;38;05;255m();[m
  [00;38;05;255mview_t[m [00;38;05;255m*[mview [00;38;05;255m=[m [00;38;05;255mfocusView[m[00;38;05;255m();[m

  view[00;38;05;255m->[mscrollY [00;38;05;255m+=[m dR [00;38;05;255m*[m st[00;38;05;255m.[mfont[00;38;05;255m.[mlineSkip[00;38;05;255m;[m

  view[00;38;05;255m->[mscrollY [00;38;05;255m=[m [00;38;05;255mclamp[m[00;38;05;255m([mframe[00;38;05;255m->[mheight [00;38;05;255m-[m [00;38;05;255mdocHeight[m[00;38;05;255m([mdoc[00;38;05;255m)[m [00;38;05;255m-[m st[00;38;05;255m.[mfont[00;38;05;255m.[mlineSkip[00;38;05;255m,[m view[00;38;05;255m->[mscrollY[00;38;05;255m,[m [00;38;05;171m0[m[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255m// BAL: do this on mouse clicks...[m
[00;38;05;255mvoid[m [00;38;05;255mfocusTrackCursor[m[00;38;05;255m([m[00;38;05;255mint[m height[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mview_t[m [00;38;05;255m*[mview [00;38;05;255m=[m [00;38;05;255mfocusView[m[00;38;05;255m();[m
  [00;38;05;255mint[m scrollR [00;38;05;255m=[m view[00;38;05;255m->[mscrollY [00;38;05;255m/[m st[00;38;05;255m.[mfont[00;38;05;255m.[mlineSkip[00;38;05;255m;[m

  [00;38;05;255mint[m dR [00;38;05;255m=[m scrollR [00;38;05;255m+[m [00;38;05;255m([mst[00;38;05;255m.[mmouseSelectionInProgress [00;38;05;255m?[m view[00;38;05;255m->[mselection[00;38;05;255m.[mrow [00;38;05;255m:[m view[00;38;05;255m->[mcursor[00;38;05;255m.[mrow[00;38;05;255m);[m

  [00;38;05;75mif[m [00;38;05;255m([mdR [00;38;05;255m<[m height[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255mfocusScrollY[m[00;38;05;255m([mheight [00;38;05;255m-[m dR[00;38;05;255m);[m
    [00;38;05;196m}[m [00;38;05;75melse[m [00;38;05;196m{[m
    [00;38;05;255mint[m lastRow [00;38;05;255m=[m [00;38;05;255mframeRows[m[00;38;05;255m([m[00;38;05;255mfocusFrame[m[00;38;05;255m())[m [00;38;05;255m-[m height[00;38;05;255m;[m
    [00;38;05;75mif[m [00;38;05;255m([mdR [00;38;05;255m>[m lastRow[00;38;05;255m)[m [00;38;05;196m{[m
      [00;38;05;255mfocusScrollY[m[00;38;05;255m([mlastRow [00;38;05;255m-[m dR[00;38;05;255m);[m
    [00;38;05;196m}[m
  [00;38;05;196m}[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mselectionSetRowCol[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mview_t[m [00;38;05;255m*[mview [00;38;05;255m=[m [00;38;05;255mfocusView[m[00;38;05;255m();[m
  [00;38;05;255mint[m column [00;38;05;255m=[m [00;38;05;255mxToColumn[m[00;38;05;255m([mst[00;38;05;255m.[mevent[00;38;05;255m.[mbutton[00;38;05;255m.[mx [00;38;05;255m-[m st[00;38;05;255m.[mdownCxtX[00;38;05;255m);[m
  [00;38;05;255mcursorSetRowCol[m[00;38;05;255m(&[mview[00;38;05;255m->[mselection[00;38;05;255m,[m [00;38;05;255myToRow[m[00;38;05;255m([mst[00;38;05;255m.[mevent[00;38;05;255m.[mbutton[00;38;05;255m.[my [00;38;05;255m-[m st[00;38;05;255m.[mdownCxtY[00;38;05;255m),[m column[00;38;05;255m,[m [00;38;05;255mfocusDoc[m[00;38;05;255m());[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mselectionEnd[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mview_t[m [00;38;05;255m*[mview [00;38;05;255m=[m [00;38;05;255mfocusView[m[00;38;05;255m();[m
  view[00;38;05;255m->[mselectMode [00;38;05;255m=[m NO_SELECT[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mmouseButtonUpEvent[m[00;38;05;255m()[m
[00;38;05;196m{[m
  st[00;38;05;255m.[mmouseSelectionInProgress [00;38;05;255m=[m false[00;38;05;255m;[m
  [00;38;05;255mselectionSetRowCol[m[00;38;05;255m();[m
  [00;38;05;255mview_t[m [00;38;05;255m*[mview [00;38;05;255m=[m [00;38;05;255mfocusView[m[00;38;05;255m();[m
  [00;38;05;75mif[m [00;38;05;255m([m[00;38;05;255mcursorEq[m[00;38;05;255m(&[mview[00;38;05;255m->[mcursor[00;38;05;255m,[m [00;38;05;255m&[mview[00;38;05;255m->[mselection[00;38;05;255m))[m [00;38;05;255mselectionEnd[m[00;38;05;255m();[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mmouseButtonDownEvent[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mcontextReinit[m[00;38;05;255m();[m
  [00;38;05;255mwidgetAt[m[00;38;05;255m([mgui[00;38;05;255m,[m st[00;38;05;255m.[mevent[00;38;05;255m.[mbutton[00;38;05;255m.[mx[00;38;05;255m,[m st[00;38;05;255m.[mevent[00;38;05;255m.[mbutton[00;38;05;255m.[my[00;38;05;255m);[m
  [00;38;05;75mif[m [00;38;05;255m([mcontext[00;38;05;255m.[mwid [00;38;05;255m<[m [00;38;05;171m0[m [00;38;05;255m||[m context[00;38;05;255m.[mwid [00;38;05;255m>[m [00;38;05;255mnumFrames[m[00;38;05;255m())[m
    [00;38;05;196m{[m
      [00;38;05;75mreturn[m[00;38;05;255m;[m
    [00;38;05;196m}[m

  st[00;38;05;255m.[mmouseSelectionInProgress [00;38;05;255m=[m true[00;38;05;255m;[m
  [00;38;05;255msetFocusFrame[m[00;38;05;255m([mcontext[00;38;05;255m.[mwid[00;38;05;255m);[m

  [00;38;05;255mview_t[m [00;38;05;255m*[mview [00;38;05;255m=[m [00;38;05;255mfocusView[m[00;38;05;255m();[m
  view[00;38;05;255m->[mselectMode [00;38;05;255m=[m CHAR_SELECT[00;38;05;255m;[m
  [00;38;05;75mif[m [00;38;05;255m([mst[00;38;05;255m.[mevent[00;38;05;255m.[mbutton[00;38;05;255m.[mbutton [00;38;05;255m==[m SDL_BUTTON_RIGHT[00;38;05;255m)[m view[00;38;05;255m->[mselectMode [00;38;05;255m=[m LINE_SELECT[00;38;05;255m;[m

  st[00;38;05;255m.[mdownCxtX [00;38;05;255m=[m context[00;38;05;255m.[mx[00;38;05;255m;[m
  st[00;38;05;255m.[mdownCxtY [00;38;05;255m=[m context[00;38;05;255m.[my[00;38;05;255m;[m

  [00;38;05;255mselectionSetRowCol[m[00;38;05;255m();[m
  [00;38;05;255mcursorCopy[m[00;38;05;255m(&[mview[00;38;05;255m->[mcursor[00;38;05;255m,[m [00;38;05;255m&[mview[00;38;05;255m->[mselection[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mmouseMotionEvent[m[00;38;05;255m()[m
[00;38;05;196m{[m
    [00;38;05;75mif[m [00;38;05;255m([mst[00;38;05;255m.[mmouseSelectionInProgress[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255mselectionSetRowCol[m[00;38;05;255m();[m
      [00;38;05;255m/* int height = 1; */[m
      [00;38;05;255m/* view_t *view = focusView(); */[m
      [00;38;05;255m/* int scrollR = view->scrollY / st.font.lineSkip; */[m

      [00;38;05;255m/* int dR = scrollR + view->selection.row; */[m
      [00;38;05;255m/* if (dR < height) */[m
      [00;38;05;255m/*   { */[m
      [00;38;05;255m/*     focusScrollY(height - dR); */[m
      [00;38;05;255m/*     SDL_PushEvent(&st.event); */[m
      [00;38;05;255m/*   } else { */[m
      [00;38;05;255m/*   int lastRow = frameRows(focusFrame()) - height; */[m
      [00;38;05;255m/*   if (dR > lastRow) { */[m
      [00;38;05;255m/*     focusScrollY(lastRow - dR); */[m
      [00;38;05;255m/*     SDL_PushEvent(&st.event); */[m
      [00;38;05;255m/*   } */[m
      [00;38;05;255m/* } */[m
    [00;38;05;196m}[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mmouseWheelEvent[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mfocusScrollY[m[00;38;05;255m([mst[00;38;05;255m.[mevent[00;38;05;255m.[mwheel[00;38;05;255m.[my[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mdoKeyPress[m[00;38;05;255m([m[00;38;05;255muchar[m c[00;38;05;255m)[m
[00;38;05;196m{[m
    keyHandler[00;38;05;255m[[m[00;38;05;255mfocusView[m[00;38;05;255m()->[mmode[00;38;05;255m][[mc[00;38;05;255m]([mc[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mrecordKeyPress[m[00;38;05;255m([m[00;38;05;255muchar[m c[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mint[m refFrame [00;38;05;255m=[m [00;38;05;255mfocusFrameRef[m[00;38;05;255m();[m
  [00;38;05;75mif[m [00;38;05;255m([mrefFrame [00;38;05;255m==[m BUILTINS_FRAME[00;38;05;255m)[m [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;255msetFocusFrame[m[00;38;05;255m([mBUILTINS_FRAME[00;38;05;255m);[m
  [00;38;05;255msetFocusView[m[00;38;05;255m([mMACRO_BUF[00;38;05;255m);[m
  [00;38;05;255mbuiltinInsertChar[m[00;38;05;255m([mc[00;38;05;255m);[m
  [00;38;05;255msetFocusFrame[m[00;38;05;255m([mrefFrame[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mkeyDownEvent[m[00;38;05;255m()[m
[00;38;05;196m{[m
    [00;38;05;255mSDL_Keycode[m sym [00;38;05;255m=[m st[00;38;05;255m.[mevent[00;38;05;255m.[mkey[00;38;05;255m.[mkeysym[00;38;05;255m.[msym[00;38;05;255m;[m
    [00;38;05;75mif[m [00;38;05;255m([msym [00;38;05;255m==[m SDLK_LSHIFT [00;38;05;255m||[m sym [00;38;05;255m==[m SDLK_RSHIFT[00;38;05;255m)[m [00;38;05;75mreturn[m[00;38;05;255m;[m
    [00;38;05;255muchar[m c [00;38;05;255m=[m [00;38;05;255mgetKeyChar[m[00;38;05;255m([msym[00;38;05;255m);[m
    [00;38;05;255mbool[m wasRecording [00;38;05;255m=[m st[00;38;05;255m.[misRecording[00;38;05;255m;[m
    [00;38;05;255mdoKeyPress[m[00;38;05;255m([mc[00;38;05;255m);[m
    [00;38;05;75mif[m [00;38;05;255m([mwasRecording [00;38;05;255m&&[m st[00;38;05;255m.[misRecording[00;38;05;255m)[m
    [00;38;05;196m{[m
        [00;38;05;255mrecordKeyPress[m[00;38;05;255m([mc[00;38;05;255m);[m
    [00;38;05;196m}[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mstringAppendNull[m[00;38;05;255m([m[00;38;05;255mstring_t[m [00;38;05;255m*[ms[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mchar[m [00;38;05;255m*[mc [00;38;05;255m=[m [00;38;05;255marrayPushUninit[m[00;38;05;255m([ms[00;38;05;255m);[m
  [00;38;05;255m*[mc [00;38;05;255m=[m [00;38;05;196m'[m[00;38;05;255m\0[m[00;38;05;196m'[m[00;38;05;255m;[m
  [00;38;05;255marrayPop[m[00;38;05;255m([ms[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mdoSearch[m[00;38;05;255m([m[00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc[00;38;05;255m,[m [00;38;05;255mchar[m [00;38;05;255m*[msearch[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255massert[m[00;38;05;255m([msearch[00;38;05;255m);[m
  [00;38;05;255mstringAppendNull[m[00;38;05;255m(&[mdoc[00;38;05;255m->[mcontents[00;38;05;255m);[m
  [00;38;05;255mchar[m [00;38;05;255m*[mhaystack [00;38;05;255m=[m doc[00;38;05;255m->[mcontents[00;38;05;255m.[mstart[00;38;05;255m;[m
  [00;38;05;255mchar[m [00;38;05;255m*[mreplace [00;38;05;255m=[m [00;38;05;255mdieIfNull[m[00;38;05;255m([m[00;38;05;255mstrdup[m[00;38;05;255m([msearch[00;38;05;255m));[m
  [00;38;05;255mchar[m [00;38;05;255m*[mtemp [00;38;05;255m=[m replace[00;38;05;255m;[m
  [00;38;05;255mchar[m [00;38;05;255m*[mneedle [00;38;05;255m=[m [00;38;05;255mstrsep[m[00;38;05;255m(&[mreplace[00;38;05;255m,[m [00;38;05;196m"/"[m[00;38;05;255m);[m
  [00;38;05;255m// needle is length 0 if no needle[m
  [00;38;05;255m// replace is NULL if no replace[m
  st[00;38;05;255m.[msearchLen [00;38;05;255m=[m [00;38;05;255mstrlen[m[00;38;05;255m([mneedle[00;38;05;255m);[m
  st[00;38;05;255m.[misReplace [00;38;05;255m=[m replace [00;38;05;255m!=[m NULL[00;38;05;255m;[m
  [00;38;05;255marrayReinit[m[00;38;05;255m(&[mst[00;38;05;255m.[mreplace[00;38;05;255m);[m
  [00;38;05;255msearchBuffer_t[m [00;38;05;255m*[mresults [00;38;05;255m=[m [00;38;05;255m&[mdoc[00;38;05;255m->[msearchResults[00;38;05;255m;[m
  [00;38;05;255marrayReinit[m[00;38;05;255m([mresults[00;38;05;255m);[m
  [00;38;05;75mif[m [00;38;05;255m([mst[00;38;05;255m.[misReplace[00;38;05;255m)[m [00;38;05;196m{[m
    [00;38;05;255marrayInsert[m[00;38;05;255m(&[mst[00;38;05;255m.[mreplace[00;38;05;255m,[m [00;38;05;171m0[m[00;38;05;255m,[m replace[00;38;05;255m,[m [00;38;05;255mstrlen[m[00;38;05;255m([mreplace[00;38;05;255m));[m
  [00;38;05;196m}[m
  [00;38;05;75mif[m [00;38;05;255m([mst[00;38;05;255m.[msearchLen [00;38;05;255m==[m [00;38;05;171m0[m[00;38;05;255m)[m [00;38;05;75mgoto[m done[00;38;05;255m;[m

  [00;38;05;255mchar[m [00;38;05;255m*[mp [00;38;05;255m=[m haystack[00;38;05;255m;[m
  [00;38;05;75mwhile[m [00;38;05;255m(([mp [00;38;05;255m=[m [00;38;05;255mstrcasestr[m[00;38;05;255m([mp[00;38;05;255m,[m needle[00;38;05;255m)))[m
    [00;38;05;196m{[m
      [00;38;05;255mint[m [00;38;05;255m*[moff [00;38;05;255m=[m [00;38;05;255marrayPushUninit[m[00;38;05;255m([mresults[00;38;05;255m);[m
      [00;38;05;255m*[moff [00;38;05;255m=[m p [00;38;05;255m-[m haystack[00;38;05;255m;[m
      p[00;38;05;255m++;[m
    [00;38;05;196m}[m

[00;38;05;255m done:[m
  [00;38;05;255mfree[m[00;38;05;255m([mtemp[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mchar[m [00;38;05;255m*[m[00;38;05;255mfocusElem[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;75mif[m [00;38;05;255m([m[00;38;05;255mfocusFrameRef[m[00;38;05;255m()[m [00;38;05;255m!=[m BUILTINS_FRAME[00;38;05;255m)[m [00;38;05;75mreturn[m NULL[00;38;05;255m;[m
  [00;38;05;255mint[m offset [00;38;05;255m=[m [00;38;05;255mfocusView[m[00;38;05;255m()->[mcursor[00;38;05;255m.[moffset[00;38;05;255m;[m
  [00;38;05;255mint[m i [00;38;05;255m=[m [00;38;05;255mdistanceToStartOfElem[m[00;38;05;255m([m[00;38;05;255mfocusDoc[m[00;38;05;255m()->[mcontents[00;38;05;255m.[mstart[00;38;05;255m,[m offset[00;38;05;255m);[m
  [00;38;05;255mchar[m [00;38;05;255m*[mp [00;38;05;255m=[m [00;38;05;255mfocusDoc[m[00;38;05;255m()->[mcontents[00;38;05;255m.[mstart [00;38;05;255m+[m offset [00;38;05;255m+[m i[00;38;05;255m;[m
  [00;38;05;75mreturn[m p[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mdoSearchIfNeeded[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;75mif[m [00;38;05;255m([m[00;38;05;255mfocusViewRef[m[00;38;05;255m()[m [00;38;05;255m!=[m SEARCH_BUF[00;38;05;255m)[m [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;255mchar[m [00;38;05;255m*[msearch [00;38;05;255m=[m [00;38;05;255mfocusElem[m[00;38;05;255m();[m
  [00;38;05;75mif[m [00;38;05;255m(![msearch[00;38;05;255m)[m [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;255m// search main frame doc[m
  [00;38;05;255mframe_t[m [00;38;05;255m*[mframe [00;38;05;255m=[m [00;38;05;255mframeOf[m[00;38;05;255m([mMAIN_FRAME[00;38;05;255m);[m
  [00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc [00;38;05;255m=[m [00;38;05;255mdocOf[m[00;38;05;255m([m[00;38;05;255mviewOf[m[00;38;05;255m([mframe[00;38;05;255m));[m
  [00;38;05;255mdoSearch[m[00;38;05;255m([mdoc[00;38;05;255m,[m search[00;38;05;255m);[m
  [00;38;05;255m// search secondary frame doc (if different)[m
  frame [00;38;05;255m=[m [00;38;05;255mframeOf[m[00;38;05;255m([mSECONDARY_FRAME[00;38;05;255m);[m
  [00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc1 [00;38;05;255m=[m [00;38;05;255mdocOf[m[00;38;05;255m([m[00;38;05;255mviewOf[m[00;38;05;255m([mframe[00;38;05;255m));[m
  [00;38;05;75mif[m [00;38;05;255m([mdoc1 [00;38;05;255m==[m doc[00;38;05;255m)[m [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;255mdoSearch[m[00;38;05;255m([mdoc1[00;38;05;255m,[m search[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mstMoveCursorOffset[m[00;38;05;255m([m[00;38;05;255mint[m offset[00;38;05;255m)[m
[00;38;05;196m{[m
    [00;38;05;255mcursorSetOffset[m[00;38;05;255m([m[00;38;05;255mfocusCursor[m[00;38;05;255m(),[m offset[00;38;05;255m,[m [00;38;05;255mfocusDoc[m[00;38;05;255m());[m
    [00;38;05;255mfocusTrackCursor[m[00;38;05;255m([mAUTO_SCROLL_HEIGHT[00;38;05;255m);[m
    [00;38;05;255mdoSearchIfNeeded[m[00;38;05;255m();[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mstMoveCursorRowCol[m[00;38;05;255m([m[00;38;05;255mint[m row[00;38;05;255m,[m [00;38;05;255mint[m col[00;38;05;255m)[m
[00;38;05;196m{[m
    [00;38;05;255mcursorSetRowCol[m[00;38;05;255m([m[00;38;05;255mfocusCursor[m[00;38;05;255m(),[m row[00;38;05;255m,[m col[00;38;05;255m,[m [00;38;05;255mfocusDoc[m[00;38;05;255m());[m
    [00;38;05;255mfocusTrackCursor[m[00;38;05;255m([mAUTO_SCROLL_HEIGHT[00;38;05;255m);[m
    [00;38;05;255mdoSearchIfNeeded[m[00;38;05;255m();[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mbackwardChar[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mstMoveCursorOffset[m[00;38;05;255m([m[00;38;05;255mfocusCursor[m[00;38;05;255m()->[moffset [00;38;05;255m-[m [00;38;05;171m1[m[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mforwardChar[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mstMoveCursorOffset[m[00;38;05;255m([m[00;38;05;255mfocusCursor[m[00;38;05;255m()->[moffset [00;38;05;255m+[m [00;38;05;171m1[m[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255msetNavigateMode[m[00;38;05;255m()[m
[00;38;05;196m{[m
    [00;38;05;255mfocusView[m[00;38;05;255m()->[mmode [00;38;05;255m=[m NAVIGATE_MODE[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255msetInsertMode[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;75mif[m [00;38;05;255m([m[00;38;05;255mfocusDoc[m[00;38;05;255m()->[misReadOnly[00;38;05;255m)[m [00;38;05;75mreturn[m[00;38;05;255m;[m

  [00;38;05;255mfocusView[m[00;38;05;255m()->[mmode [00;38;05;255m=[m INSERT_MODE[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255msetNavigateModeAndDoKeyPress[m[00;38;05;255m([m[00;38;05;255muchar[m c[00;38;05;255m)[m
[00;38;05;196m{[m
    [00;38;05;255msetNavigateMode[m[00;38;05;255m();[m
    [00;38;05;255mdoKeyPress[m[00;38;05;255m([mc[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mmoveLines[m[00;38;05;255m([m[00;38;05;255mint[m dRow[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mcursor_t[m [00;38;05;255m*[mcursor [00;38;05;255m=[m [00;38;05;255mfocusCursor[m[00;38;05;255m();[m
  [00;38;05;255mint[m col [00;38;05;255m=[m cursor[00;38;05;255m->[mpreferredColumn[00;38;05;255m;[m

  [00;38;05;255mstMoveCursorRowCol[m[00;38;05;255m([mcursor[00;38;05;255m->[mrow [00;38;05;255m+[m dRow[00;38;05;255m,[m col[00;38;05;255m);[m
  cursor[00;38;05;255m->[mpreferredColumn [00;38;05;255m=[m col[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mbackwardLine[m[00;38;05;255m()[m
[00;38;05;196m{[m
    [00;38;05;255mmoveLines[m[00;38;05;255m(-[m[00;38;05;171m1[m[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mforwardLine[m[00;38;05;255m()[m
[00;38;05;196m{[m
    [00;38;05;255mmoveLines[m[00;38;05;255m([m[00;38;05;171m1[m[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mchar[m [00;38;05;255mnextCharAfterSpaces[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc [00;38;05;255m=[m [00;38;05;255mfocusDoc[m[00;38;05;255m();[m
  [00;38;05;255mchar[m [00;38;05;255m*[mp [00;38;05;255m=[m doc[00;38;05;255m->[mcontents[00;38;05;255m.[mstart [00;38;05;255m+[m [00;38;05;255mfocusCursor[m[00;38;05;255m()->[moffset[00;38;05;255m;[m
  [00;38;05;255mchar[m [00;38;05;255m*[mend [00;38;05;255m=[m [00;38;05;255marrayTop[m[00;38;05;255m(&[mdoc[00;38;05;255m->[mcontents[00;38;05;255m);[m

  [00;38;05;75mwhile[m[00;38;05;255m([mp [00;38;05;255m<[m end [00;38;05;255m&&[m [00;38;05;255m*[mp [00;38;05;255m==[m [00;38;05;196m' '[m[00;38;05;255m)[m p[00;38;05;255m++;[m
  [00;38;05;75mreturn[m p [00;38;05;255m==[m end [00;38;05;255m?[m [00;38;05;196m'[m[00;38;05;255m\0[m[00;38;05;196m'[m [00;38;05;255m:[m [00;38;05;255m*[mp[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mforwardBlankLine[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mbackwardSOL[m[00;38;05;255m();[m
  [00;38;05;255mchar[m r [00;38;05;255m=[m [00;38;05;255mnextCharAfterSpaces[m[00;38;05;255m();[m
  [00;38;05;75mwhile[m [00;38;05;255m([mr [00;38;05;255m!=[m [00;38;05;196m'[m[00;38;05;255m\0[m[00;38;05;196m'[m [00;38;05;255m&&[m r [00;38;05;255m!=[m [00;38;05;196m'[m[00;38;05;255m\n[m[00;38;05;196m'[m[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255mforwardLine[m[00;38;05;255m();[m
      r [00;38;05;255m=[m [00;38;05;255mnextCharAfterSpaces[m[00;38;05;255m();[m
    [00;38;05;196m}[m
  [00;38;05;75mwhile[m [00;38;05;255m([mr [00;38;05;255m!=[m [00;38;05;196m'[m[00;38;05;255m\0[m[00;38;05;196m'[m [00;38;05;255m&&[m r [00;38;05;255m==[m [00;38;05;196m'[m[00;38;05;255m\n[m[00;38;05;196m'[m[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255mforwardLine[m[00;38;05;255m();[m
      r [00;38;05;255m=[m [00;38;05;255mnextCharAfterSpaces[m[00;38;05;255m();[m
    [00;38;05;196m}[m
[00;38;05;196m}[m

[00;38;05;255mbool[m [00;38;05;255misSOF[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;75mreturn[m [00;38;05;255mfocusCursor[m[00;38;05;255m()->[moffset [00;38;05;255m==[m [00;38;05;171m0[m[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mbackwardBlankLine[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mbackwardSOL[m[00;38;05;255m();[m
  [00;38;05;255mchar[m r [00;38;05;255m=[m [00;38;05;255mnextCharAfterSpaces[m[00;38;05;255m();[m
  [00;38;05;75mwhile[m [00;38;05;255m(![m[00;38;05;255misSOF[m[00;38;05;255m()[m [00;38;05;255m&&[m r [00;38;05;255m!=[m [00;38;05;196m'[m[00;38;05;255m\n[m[00;38;05;196m'[m[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255mbackwardLine[m[00;38;05;255m();[m
      r [00;38;05;255m=[m [00;38;05;255mnextCharAfterSpaces[m[00;38;05;255m();[m
    [00;38;05;196m}[m
  [00;38;05;75mwhile[m [00;38;05;255m(![m[00;38;05;255misSOF[m[00;38;05;255m()[m [00;38;05;255m&&[m r [00;38;05;255m==[m [00;38;05;196m'[m[00;38;05;255m\n[m[00;38;05;196m'[m[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255mbackwardLine[m[00;38;05;255m();[m
      r [00;38;05;255m=[m [00;38;05;255mnextCharAfterSpaces[m[00;38;05;255m();[m
    [00;38;05;196m}[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mforwardSpace[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mint[m i [00;38;05;255m=[m [00;38;05;255mfocusCursor[m[00;38;05;255m()->[moffset[00;38;05;255m;[m
  [00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc [00;38;05;255m=[m [00;38;05;255mfocusDoc[m[00;38;05;255m();[m
  [00;38;05;255mstMoveCursorOffset[m[00;38;05;255m([mi [00;38;05;255m+[m [00;38;05;255mdistanceToNextSpace[m[00;38;05;255m([mdoc[00;38;05;255m->[mcontents[00;38;05;255m.[mstart [00;38;05;255m+[m i[00;38;05;255m,[m [00;38;05;255marrayTop[m[00;38;05;255m(&[mdoc[00;38;05;255m->[mcontents[00;38;05;255m)));[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mbackwardSpace[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mint[m i [00;38;05;255m=[m [00;38;05;255mfocusCursor[m[00;38;05;255m()->[moffset[00;38;05;255m;[m
  [00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc [00;38;05;255m=[m [00;38;05;255mfocusDoc[m[00;38;05;255m();[m
  [00;38;05;255mstMoveCursorOffset[m[00;38;05;255m([mi [00;38;05;255m+[m [00;38;05;255mdistanceToPrevSpace[m[00;38;05;255m([mdoc[00;38;05;255m->[mcontents[00;38;05;255m.[mstart[00;38;05;255m,[m doc[00;38;05;255m->[mcontents[00;38;05;255m.[mstart [00;38;05;255m+[m i[00;38;05;255m));[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mbackwardPage[m[00;38;05;255m()[m
[00;38;05;196m{[m
    [00;38;05;255mmoveLines[m[00;38;05;255m(-[m[00;38;05;255mmax[m[00;38;05;255m([m[00;38;05;171m1[m[00;38;05;255m,[m [00;38;05;255mframeRows[m[00;38;05;255m([m[00;38;05;255mfocusFrame[m[00;38;05;255m())[m [00;38;05;255m-[m AUTO_SCROLL_HEIGHT[00;38;05;255m));[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mforwardPage[m[00;38;05;255m()[m
[00;38;05;196m{[m
    [00;38;05;255mmoveLines[m[00;38;05;255m([m[00;38;05;255mmax[m[00;38;05;255m([m[00;38;05;171m1[m[00;38;05;255m,[m [00;38;05;255mframeRows[m[00;38;05;255m([m[00;38;05;255mfocusFrame[m[00;38;05;255m())[m [00;38;05;255m-[m AUTO_SCROLL_HEIGHT[00;38;05;255m));[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mbackwardSOF[m[00;38;05;255m()[m
[00;38;05;196m{[m
    [00;38;05;255mstMoveCursorOffset[m[00;38;05;255m([m[00;38;05;171m0[m[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mforwardEOF[m[00;38;05;255m()[m
[00;38;05;196m{[m
    [00;38;05;255mstMoveCursorOffset[m[00;38;05;255m([mINT_MAX [00;38;05;255m-[m [00;38;05;171m1[m[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mbackwardSOL[m[00;38;05;255m()[m
[00;38;05;196m{[m
    [00;38;05;255mstMoveCursorRowCol[m[00;38;05;255m([m[00;38;05;255mfocusCursor[m[00;38;05;255m()->[mrow[00;38;05;255m,[m [00;38;05;171m0[m[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mforwardEOL[m[00;38;05;255m()[m
[00;38;05;196m{[m
    [00;38;05;255mstMoveCursorRowCol[m[00;38;05;255m([m[00;38;05;255mfocusCursor[m[00;38;05;255m()->[mrow[00;38;05;255m,[m INT_MAX[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255minsertString[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m,[m [00;38;05;255muint[m len[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255massert[m[00;38;05;255m([ms[00;38;05;255m);[m
  [00;38;05;75mif[m[00;38;05;255m([mlen [00;38;05;255m<=[m [00;38;05;171m0[m[00;38;05;255m)[m [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;255mdocPushInsert[m[00;38;05;255m([m[00;38;05;255mfocusDoc[m[00;38;05;255m(),[m [00;38;05;255mfocusCursor[m[00;38;05;255m()->[moffset[00;38;05;255m,[m s[00;38;05;255m,[m len[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mbuiltinInsertString[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m,[m [00;38;05;255muint[m len[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255massert[m[00;38;05;255m([ms[00;38;05;255m);[m
  [00;38;05;75mif[m[00;38;05;255m([mlen [00;38;05;255m<=[m [00;38;05;171m0[m[00;38;05;255m)[m [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;255mdocInsert[m[00;38;05;255m([m[00;38;05;255mfocusDoc[m[00;38;05;255m(),[m [00;38;05;255mfocusCursor[m[00;38;05;255m()->[moffset[00;38;05;255m,[m s[00;38;05;255m,[m len[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255minsertCString[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m)[m
[00;38;05;196m{[m
    [00;38;05;255massert[m[00;38;05;255m([ms[00;38;05;255m);[m
    [00;38;05;255minsertString[m[00;38;05;255m([ms[00;38;05;255m,[m [00;38;05;255m([muint[00;38;05;255m)[m[00;38;05;255mstrlen[m[00;38;05;255m([ms[00;38;05;255m));[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mbuiltinInsertCString[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255massert[m[00;38;05;255m([ms[00;38;05;255m);[m
  [00;38;05;255mbuiltinInsertString[m[00;38;05;255m([ms[00;38;05;255m,[m [00;38;05;255m([muint[00;38;05;255m)[m[00;38;05;255mstrlen[m[00;38;05;255m([ms[00;38;05;255m));[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255minsertChar[m[00;38;05;255m([m[00;38;05;255muchar[m c[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255minsertString[m[00;38;05;255m(([m[00;38;05;255mchar[m[00;38;05;255m*)&[mc[00;38;05;255m,[m [00;38;05;171m1[m[00;38;05;255m);[m
  [00;38;05;255mforwardChar[m[00;38;05;255m();[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mbuiltinInsertChar[m[00;38;05;255m([m[00;38;05;255muchar[m c[00;38;05;255m)[m
[00;38;05;196m{[m
    [00;38;05;255mbuiltinInsertString[m[00;38;05;255m(([m[00;38;05;255mchar[m[00;38;05;255m*)&[mc[00;38;05;255m,[m [00;38;05;171m1[m[00;38;05;255m);[m
    [00;38;05;255mforwardChar[m[00;38;05;255m();[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mhelpBufInit[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255msetFocusFrame[m[00;38;05;255m([mBUILTINS_FRAME[00;38;05;255m);[m
  [00;38;05;255msetFocusView[m[00;38;05;255m([mHELP_BUF[00;38;05;255m);[m

  [00;38;05;255mchar[m s[00;38;05;255m[[m[00;38;05;171m1024[m[00;38;05;255m];[m

  [00;38;05;75mfor[m[00;38;05;255m([m[00;38;05;255mint[m i [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m i [00;38;05;255m<[m NUM_BUILTIN_MACROS[00;38;05;255m;[m [00;38;05;255m++[mi[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255mchar[m c [00;38;05;255m=[m builtinMacros[00;38;05;255m[[mi[00;38;05;255m][[m[00;38;05;171m0[m[00;38;05;255m];[m
      [00;38;05;75mif[m [00;38;05;255m([mc [00;38;05;255m==[m [00;38;05;196m'[m[00;38;05;255m\n[m[00;38;05;196m'[m[00;38;05;255m)[m
        [00;38;05;196m{[m
          [00;38;05;255msprintf[m[00;38;05;255m([ms[00;38;05;255m,[m [00;38;05;196m"'[m[00;38;05;255m\\[m[00;38;05;196mn': %s[m[00;38;05;255m\n[m[00;38;05;196m"[m[00;38;05;255m,[m builtinMacrosHelp[00;38;05;255m[[mi[00;38;05;255m]);[m
        [00;38;05;196m}[m
      [00;38;05;75melse[m
        [00;38;05;196m{[m
          [00;38;05;255msprintf[m[00;38;05;255m([ms[00;38;05;255m,[m [00;38;05;196m"'%c': %s[m[00;38;05;255m\n[m[00;38;05;196m"[m[00;38;05;255m,[m c[00;38;05;255m,[m builtinMacrosHelp[00;38;05;255m[[mi[00;38;05;255m]);[m
        [00;38;05;196m}[m
      [00;38;05;255mbuiltinInsertCString[m[00;38;05;255m([ms[00;38;05;255m);[m
    [00;38;05;196m}[m

  [00;38;05;255mbuiltinInsertCString[m[00;38;05;255m([m[00;38;05;196m"[m[00;38;05;255m\n[m[00;38;05;196mBuiltin Macros:[m[00;38;05;255m\n[m[00;38;05;196m"[m[00;38;05;255m);[m

  [00;38;05;75mfor[m[00;38;05;255m([m[00;38;05;255mint[m i [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m i [00;38;05;255m<[m NUM_MODES[00;38;05;255m;[m [00;38;05;255m++[mi[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;75mfor[m[00;38;05;255m([m[00;38;05;255mint[m c [00;38;05;255m=[m [00;38;05;171m0[m[00;38;05;255m;[m c [00;38;05;255m<[m NUM_KEYS[00;38;05;255m;[m [00;38;05;255m++[mc[00;38;05;255m)[m
        [00;38;05;196m{[m
          [00;38;05;75mif[m [00;38;05;255m(![mkeyHandlerHelp[00;38;05;255m[[mi[00;38;05;255m][[mc[00;38;05;255m])[m [00;38;05;75mcontinue[m[00;38;05;255m;[m
          [00;38;05;75mswitch[m [00;38;05;255m([mc[00;38;05;255m)[m [00;38;05;196m{[m
          [00;38;05;75mcase[m [00;38;05;196m'[m[00;38;05;255m\0[m[00;38;05;196m'[m[00;38;05;255m:[m
            [00;38;05;75mcontinue[m[00;38;05;255m;[m
          [00;38;05;75mcase[m [00;38;05;196m'[m[00;38;05;255m\t[m[00;38;05;196m'[m[00;38;05;255m:[m
            [00;38;05;255msprintf[m[00;38;05;255m([ms[00;38;05;255m,[m [00;38;05;196m"'[m[00;38;05;255m\t[m[00;38;05;196m': %s[m[00;38;05;255m\n[m[00;38;05;196m"[m[00;38;05;255m,[m keyHandlerHelp[00;38;05;255m[[mi[00;38;05;255m][[mc[00;38;05;255m]);[m
            [00;38;05;75mbreak[m[00;38;05;255m;[m
          [00;38;05;75mcase[m KEY_END[00;38;05;255m:[m
            [00;38;05;255msprintf[m[00;38;05;255m([ms[00;38;05;255m,[m [00;38;05;196m"'END': %s[m[00;38;05;255m\n[m[00;38;05;196m"[m[00;38;05;255m,[m keyHandlerHelp[00;38;05;255m[[mi[00;38;05;255m][[mc[00;38;05;255m]);[m
            [00;38;05;75mbreak[m[00;38;05;255m;[m
          [00;38;05;75mcase[m KEY_HOME[00;38;05;255m:[m
            [00;38;05;255msprintf[m[00;38;05;255m([ms[00;38;05;255m,[m [00;38;05;196m"'HOME': %s[m[00;38;05;255m\n[m[00;38;05;196m"[m[00;38;05;255m,[m keyHandlerHelp[00;38;05;255m[[mi[00;38;05;255m][[mc[00;38;05;255m]);[m
            [00;38;05;75mbreak[m[00;38;05;255m;[m
          [00;38;05;75mcase[m KEY_PAGEUP[00;38;05;255m:[m
            [00;38;05;255msprintf[m[00;38;05;255m([ms[00;38;05;255m,[m [00;38;05;196m"'PAGEUP': %s[m[00;38;05;255m\n[m[00;38;05;196m"[m[00;38;05;255m,[m keyHandlerHelp[00;38;05;255m[[mi[00;38;05;255m][[mc[00;38;05;255m]);[m
            [00;38;05;75mbreak[m[00;38;05;255m;[m
          [00;38;05;75mcase[m KEY_PAGEDOWN[00;38;05;255m:[m
            [00;38;05;255msprintf[m[00;38;05;255m([ms[00;38;05;255m,[m [00;38;05;196m"'PAGEDOWN': %s[m[00;38;05;255m\n[m[00;38;05;196m"[m[00;38;05;255m,[m keyHandlerHelp[00;38;05;255m[[mi[00;38;05;255m][[mc[00;38;05;255m]);[m
            [00;38;05;75mbreak[m[00;38;05;255m;[m
          [00;38;05;75mcase[m KEY_DELETE[00;38;05;255m:[m
            [00;38;05;255msprintf[m[00;38;05;255m([ms[00;38;05;255m,[m [00;38;05;196m"'DEL': %s[m[00;38;05;255m\n[m[00;38;05;196m"[m[00;38;05;255m,[m keyHandlerHelp[00;38;05;255m[[mi[00;38;05;255m][[mc[00;38;05;255m]);[m
            [00;38;05;75mbreak[m[00;38;05;255m;[m
          [00;38;05;75mcase[m KEY_SHIFT_UP[00;38;05;255m:[m
            [00;38;05;255msprintf[m[00;38;05;255m([ms[00;38;05;255m,[m [00;38;05;196m"'SHIFT_UP': %s[m[00;38;05;255m\n[m[00;38;05;196m"[m[00;38;05;255m,[m keyHandlerHelp[00;38;05;255m[[mi[00;38;05;255m][[mc[00;38;05;255m]);[m
            [00;38;05;75mbreak[m[00;38;05;255m;[m
          [00;38;05;75mcase[m KEY_SHIFT_DOWN[00;38;05;255m:[m
            [00;38;05;255msprintf[m[00;38;05;255m([ms[00;38;05;255m,[m [00;38;05;196m"'SHIFT_DOWN': %s[m[00;38;05;255m\n[m[00;38;05;196m"[m[00;38;05;255m,[m keyHandlerHelp[00;38;05;255m[[mi[00;38;05;255m][[mc[00;38;05;255m]);[m
            [00;38;05;75mbreak[m[00;38;05;255m;[m
          [00;38;05;75mcase[m KEY_SHIFT_LEFT[00;38;05;255m:[m
            [00;38;05;255msprintf[m[00;38;05;255m([ms[00;38;05;255m,[m [00;38;05;196m"'SHIFT_LEFT': %s[m[00;38;05;255m\n[m[00;38;05;196m"[m[00;38;05;255m,[m keyHandlerHelp[00;38;05;255m[[mi[00;38;05;255m][[mc[00;38;05;255m]);[m
            [00;38;05;75mbreak[m[00;38;05;255m;[m
          [00;38;05;75mcase[m KEY_SHIFT_RIGHT[00;38;05;255m:[m
            [00;38;05;255msprintf[m[00;38;05;255m([ms[00;38;05;255m,[m [00;38;05;196m"'SHIFT_RIGHT': %s[m[00;38;05;255m\n[m[00;38;05;196m"[m[00;38;05;255m,[m keyHandlerHelp[00;38;05;255m[[mi[00;38;05;255m][[mc[00;38;05;255m]);[m
            [00;38;05;75mbreak[m[00;38;05;255m;[m
          [00;38;05;75mcase[m KEY_SHIFT_TAB[00;38;05;255m:[m
            [00;38;05;255msprintf[m[00;38;05;255m([ms[00;38;05;255m,[m [00;38;05;196m"'SHIFT_TAB': %s[m[00;38;05;255m\n[m[00;38;05;196m"[m[00;38;05;255m,[m keyHandlerHelp[00;38;05;255m[[mi[00;38;05;255m][[mc[00;38;05;255m]);[m
            [00;38;05;75mbreak[m[00;38;05;255m;[m
[00;38;05;255m          default:[m
            [00;38;05;255msprintf[m[00;38;05;255m([ms[00;38;05;255m,[m [00;38;05;196m"'%c': %s[m[00;38;05;255m\n[m[00;38;05;196m"[m[00;38;05;255m,[m c[00;38;05;255m,[m keyHandlerHelp[00;38;05;255m[[mi[00;38;05;255m][[mc[00;38;05;255m]);[m
            [00;38;05;75mbreak[m[00;38;05;255m;[m
          [00;38;05;196m}[m
          [00;38;05;255mbuiltinInsertCString[m[00;38;05;255m([ms[00;38;05;255m);[m
        [00;38;05;196m}[m
    [00;38;05;196m}[m

  [00;38;05;255mbuiltinInsertCString[m[00;38;05;255m([m[00;38;05;196m"Builtin Keys:[m[00;38;05;255m\n[m[00;38;05;196m"[m[00;38;05;255m);[m

[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mbackwardStartOfElem[m[00;38;05;255m()[m [00;38;05;255m// BAL: remove(?)[m
[00;38;05;196m{[m
  [00;38;05;255mint[m offset [00;38;05;255m=[m [00;38;05;255mfocusView[m[00;38;05;255m()->[mcursor[00;38;05;255m.[moffset[00;38;05;255m;[m
  [00;38;05;255mint[m i [00;38;05;255m=[m [00;38;05;255mdistanceToStartOfElem[m[00;38;05;255m([m[00;38;05;255mfocusDoc[m[00;38;05;255m()->[mcontents[00;38;05;255m.[mstart[00;38;05;255m,[m offset[00;38;05;255m);[m
  [00;38;05;255mstMoveCursorOffset[m[00;38;05;255m([moffset [00;38;05;255m+[m i[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mcopyElemToClipboard[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mbackwardStartOfElem[m[00;38;05;255m();[m
  [00;38;05;255mchar[m [00;38;05;255m*[ms [00;38;05;255m=[m [00;38;05;255mfocusDoc[m[00;38;05;255m()->[mcontents[00;38;05;255m.[mstart [00;38;05;255m+[m [00;38;05;255mfocusView[m[00;38;05;255m()->[mcursor[00;38;05;255m.[moffset[00;38;05;255m;[m
  [00;38;05;255msetClipboardText[m[00;38;05;255m([ms[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mpasteBefore[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;75mif[m [00;38;05;255m([m[00;38;05;255mfocusViewRef[m[00;38;05;255m()[m [00;38;05;255m==[m COPY_BUF[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255mcopyElemToClipboard[m[00;38;05;255m();[m
      [00;38;05;75mreturn[m[00;38;05;255m;[m
    [00;38;05;196m}[m

  [00;38;05;255mchar[m [00;38;05;255m*[ms [00;38;05;255m=[m [00;38;05;255mgetClipboardText[m[00;38;05;255m();[m
  [00;38;05;75mif[m [00;38;05;255m([ms[00;38;05;255m)[m [00;38;05;255minsertCString[m[00;38;05;255m([ms[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mcopy[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m,[m [00;38;05;255muint[m len[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;75mif[m [00;38;05;255m([m[00;38;05;255mfocusViewRef[m[00;38;05;255m()[m [00;38;05;255m==[m COPY_BUF[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255mcopyElemToClipboard[m[00;38;05;255m();[m
      [00;38;05;75mreturn[m[00;38;05;255m;[m
    [00;38;05;196m}[m

  [00;38;05;255mint[m refFrame [00;38;05;255m=[m [00;38;05;255mfocusFrameRef[m[00;38;05;255m();[m
  [00;38;05;255msetFocusFrame[m[00;38;05;255m([mBUILTINS_FRAME[00;38;05;255m);[m
  [00;38;05;255msetFocusView[m[00;38;05;255m([mCOPY_BUF[00;38;05;255m);[m
  [00;38;05;255minsertNewElem[m[00;38;05;255m();[m
  [00;38;05;255mbuiltinInsertString[m[00;38;05;255m([ms[00;38;05;255m,[m len[00;38;05;255m);[m
  [00;38;05;255msetClipboardText[m[00;38;05;255m([m[00;38;05;255mfocusDoc[m[00;38;05;255m()->[mcontents[00;38;05;255m.[mstart[00;38;05;255m);[m
  [00;38;05;255msetFocusFrame[m[00;38;05;255m([mrefFrame[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mdocPushCommand[m[00;38;05;255m([m[00;38;05;255mcommandTag_t[m tag[00;38;05;255m,[m [00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc[00;38;05;255m,[m [00;38;05;255mint[m offset[00;38;05;255m,[m [00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m,[m [00;38;05;255mint[m len[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mcommand_t[m [00;38;05;255m*[mcmd[00;38;05;255m;[m
  [00;38;05;75mwhile[m [00;38;05;255m([mdoc[00;38;05;255m->[mundoStack[00;38;05;255m.[moffset [00;38;05;255m<[m doc[00;38;05;255m->[mundoStack[00;38;05;255m.[mnumElems[00;38;05;255m)[m
    [00;38;05;196m{[m
      cmd [00;38;05;255m=[m [00;38;05;255marrayPop[m[00;38;05;255m(&[mdoc[00;38;05;255m->[mundoStack[00;38;05;255m);[m
      [00;38;05;255marrayFree[m[00;38;05;255m(&[mcmd[00;38;05;255m->[mstring[00;38;05;255m);[m
    [00;38;05;196m}[m
  cmd [00;38;05;255m=[m [00;38;05;255marrayPushUninit[m[00;38;05;255m(&[mdoc[00;38;05;255m->[mundoStack[00;38;05;255m);[m
  cmd[00;38;05;255m->[mtag [00;38;05;255m=[m tag[00;38;05;255m;[m
  cmd[00;38;05;255m->[moffset [00;38;05;255m=[m offset[00;38;05;255m;[m
  [00;38;05;255marrayInit[m[00;38;05;255m(&[mcmd[00;38;05;255m->[mstring[00;38;05;255m,[m [00;38;05;75msizeof[m[00;38;05;255m([m[00;38;05;255mchar[m[00;38;05;255m));[m
  [00;38;05;255marrayInsert[m[00;38;05;255m(&[mcmd[00;38;05;255m->[mstring[00;38;05;255m,[m [00;38;05;171m0[m[00;38;05;255m,[m s[00;38;05;255m,[m len[00;38;05;255m);[m
  doc[00;38;05;255m->[mundoStack[00;38;05;255m.[moffset[00;38;05;255m++;[m
  [00;38;05;255massert[m[00;38;05;255m([mdoc[00;38;05;255m->[mundoStack[00;38;05;255m.[moffset [00;38;05;255m==[m doc[00;38;05;255m->[mundoStack[00;38;05;255m.[mnumElems[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mdocPushDelete[m[00;38;05;255m([m[00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc[00;38;05;255m,[m [00;38;05;255mint[m offset[00;38;05;255m,[m [00;38;05;255mint[m len[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;75mif[m [00;38;05;255m([mdoc[00;38;05;255m->[misReadOnly[00;38;05;255m)[m [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;75mif[m [00;38;05;255m([mdoc[00;38;05;255m->[misUserDoc[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255mdocPushCommand[m[00;38;05;255m([mDELETE[00;38;05;255m,[m doc[00;38;05;255m,[m offset[00;38;05;255m,[m doc[00;38;05;255m->[mcontents[00;38;05;255m.[mstart [00;38;05;255m+[m offset[00;38;05;255m,[m len[00;38;05;255m);[m
    [00;38;05;196m}[m
  [00;38;05;255mdocDelete[m[00;38;05;255m([mdoc[00;38;05;255m,[m offset[00;38;05;255m,[m len[00;38;05;255m);[m
  [00;38;05;255mdoSearchIfNeeded[m[00;38;05;255m();[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mdocPushInsert[m[00;38;05;255m([m[00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc[00;38;05;255m,[m [00;38;05;255mint[m offset[00;38;05;255m,[m [00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m,[m [00;38;05;255mint[m len[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;75mif[m [00;38;05;255m([mdoc[00;38;05;255m->[misReadOnly[00;38;05;255m)[m [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;75mif[m [00;38;05;255m([mdoc[00;38;05;255m->[misUserDoc[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255mdocPushCommand[m[00;38;05;255m([mINSERT[00;38;05;255m,[m doc[00;38;05;255m,[m offset[00;38;05;255m,[m s[00;38;05;255m,[m len[00;38;05;255m);[m
    [00;38;05;196m}[m
  [00;38;05;255mdocInsert[m[00;38;05;255m([mdoc[00;38;05;255m,[m offset[00;38;05;255m,[m s[00;38;05;255m,[m len[00;38;05;255m);[m
  [00;38;05;255mdoSearchIfNeeded[m[00;38;05;255m();[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mdocDoCommand[m[00;38;05;255m([m[00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc[00;38;05;255m,[m [00;38;05;255mcommandTag_t[m tag[00;38;05;255m,[m [00;38;05;255mint[m offset[00;38;05;255m,[m [00;38;05;255mstring_t[m [00;38;05;255m*[mstring[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mselectionCancel[m[00;38;05;255m();[m
  [00;38;05;255mstMoveCursorOffset[m[00;38;05;255m([moffset[00;38;05;255m);[m
  [00;38;05;75mswitch[m [00;38;05;255m([mtag[00;38;05;255m)[m
    [00;38;05;196m{[m
    [00;38;05;75mcase[m DELETE[00;38;05;255m:[m
      [00;38;05;255mdocDelete[m[00;38;05;255m([mdoc[00;38;05;255m,[m offset[00;38;05;255m,[m string[00;38;05;255m->[mnumElems[00;38;05;255m);[m
      [00;38;05;75mreturn[m[00;38;05;255m;[m
[00;38;05;255m    default:[m
      [00;38;05;255massert[m[00;38;05;255m([mtag [00;38;05;255m==[m INSERT[00;38;05;255m);[m
      [00;38;05;255mdocInsert[m[00;38;05;255m([mdoc[00;38;05;255m,[m offset[00;38;05;255m,[m string[00;38;05;255m->[mstart[00;38;05;255m,[m string[00;38;05;255m->[mnumElems[00;38;05;255m);[m
      [00;38;05;75mreturn[m[00;38;05;255m;[m
    [00;38;05;196m}[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mundo[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc [00;38;05;255m=[m [00;38;05;255mfocusDoc[m[00;38;05;255m();[m
  [00;38;05;75mif[m [00;38;05;255m([mdoc[00;38;05;255m->[mundoStack[00;38;05;255m.[moffset [00;38;05;255m==[m [00;38;05;171m0[m[00;38;05;255m)[m [00;38;05;75mreturn[m[00;38;05;255m;[m
  doc[00;38;05;255m->[mundoStack[00;38;05;255m.[moffset[00;38;05;255m--;[m
  [00;38;05;255mcommand_t[m [00;38;05;255m*[mcmd [00;38;05;255m=[m [00;38;05;255marrayFocus[m[00;38;05;255m(&[mdoc[00;38;05;255m->[mundoStack[00;38;05;255m);[m
  [00;38;05;255mdocDoCommand[m[00;38;05;255m([mdoc[00;38;05;255m,[m [00;38;05;255m![mcmd[00;38;05;255m->[mtag[00;38;05;255m,[m cmd[00;38;05;255m->[moffset[00;38;05;255m,[m [00;38;05;255m&[mcmd[00;38;05;255m->[mstring[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mredo[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc [00;38;05;255m=[m [00;38;05;255mfocusDoc[m[00;38;05;255m();[m
  [00;38;05;75mif[m [00;38;05;255m([mdoc[00;38;05;255m->[mundoStack[00;38;05;255m.[moffset [00;38;05;255m==[m doc[00;38;05;255m->[mundoStack[00;38;05;255m.[mnumElems[00;38;05;255m)[m [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;255mcommand_t[m [00;38;05;255m*[mcmd [00;38;05;255m=[m [00;38;05;255marrayFocus[m[00;38;05;255m(&[mdoc[00;38;05;255m->[mundoStack[00;38;05;255m);[m
  [00;38;05;255mdocDoCommand[m[00;38;05;255m([mdoc[00;38;05;255m,[m cmd[00;38;05;255m->[mtag[00;38;05;255m,[m cmd[00;38;05;255m->[moffset[00;38;05;255m,[m [00;38;05;255m&[mcmd[00;38;05;255m->[mstring[00;38;05;255m);[m
  doc[00;38;05;255m->[mundoStack[00;38;05;255m.[moffset[00;38;05;255m++;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mcut[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mint[m column[00;38;05;255m;[m
  [00;38;05;255mint[m row[00;38;05;255m;[m
  [00;38;05;255mint[m offset[00;38;05;255m;[m
  [00;38;05;255mint[m length[00;38;05;255m;[m

  [00;38;05;255mview_t[m [00;38;05;255m*[mview [00;38;05;255m=[m [00;38;05;255mfocusView[m[00;38;05;255m();[m

  [00;38;05;255mgetSelectionCoords[m[00;38;05;255m([mview[00;38;05;255m,[m [00;38;05;255m&[mcolumn[00;38;05;255m,[m [00;38;05;255m&[mrow[00;38;05;255m,[m [00;38;05;255m&[moffset[00;38;05;255m,[m [00;38;05;255m&[mlength[00;38;05;255m);[m

  [00;38;05;255mselectionCancel[m[00;38;05;255m();[m

  [00;38;05;75mif[m [00;38;05;255m([mlength [00;38;05;255m<=[m [00;38;05;171m0[m[00;38;05;255m)[m [00;38;05;75mreturn[m[00;38;05;255m;[m

  [00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc [00;38;05;255m=[m [00;38;05;255mfocusDoc[m[00;38;05;255m();[m

  [00;38;05;75mif[m [00;38;05;255m([mlength [00;38;05;255m>[m [00;38;05;171m1[m[00;38;05;255m)[m [00;38;05;255mcopy[m[00;38;05;255m([mdoc[00;38;05;255m->[mcontents[00;38;05;255m.[mstart [00;38;05;255m+[m offset[00;38;05;255m,[m length[00;38;05;255m);[m

  [00;38;05;255mdocPushDelete[m[00;38;05;255m([mdoc[00;38;05;255m,[m offset[00;38;05;255m,[m length[00;38;05;255m);[m

  [00;38;05;255mcursorSetRowCol[m[00;38;05;255m(&[mview[00;38;05;255m->[mcursor[00;38;05;255m,[m row[00;38;05;255m,[m column[00;38;05;255m,[m [00;38;05;255mfocusDoc[m[00;38;05;255m());[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mplayMacroString[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m,[m [00;38;05;255muint[m len[00;38;05;255m)[m
[00;38;05;196m{[m
    [00;38;05;255mchar[m [00;38;05;255m*[mdone [00;38;05;255m=[m s [00;38;05;255m+[m len[00;38;05;255m;[m

    [00;38;05;75mwhile[m [00;38;05;255m([ms [00;38;05;255m<[m done[00;38;05;255m)[m
    [00;38;05;196m{[m
        [00;38;05;255mdoKeyPress[m[00;38;05;255m(*[ms[00;38;05;255m);[m
        s[00;38;05;255m++;[m
    [00;38;05;196m}[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mplayMacroCString[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255mplayMacroString[m[00;38;05;255m([ms[00;38;05;255m,[m [00;38;05;255m([muint[00;38;05;255m)[m[00;38;05;255mstrlen[m[00;38;05;255m([ms[00;38;05;255m));[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mdoNothing[m[00;38;05;255m([m[00;38;05;255muchar[m c[00;38;05;255m)[m
[00;38;05;196m{[m
    [00;38;05;75mif[m [00;38;05;255m([mmacro[00;38;05;255m[[mc[00;38;05;255m])[m
    [00;38;05;196m{[m
        [00;38;05;255mplayMacroCString[m[00;38;05;255m([mmacro[00;38;05;255m[[mc[00;38;05;255m]);[m
        [00;38;05;75mreturn[m[00;38;05;255m;[m
    [00;38;05;196m}[m
    [00;38;05;255mselectionEnd[m[00;38;05;255m();[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mstopRecording[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mint[m refFrame [00;38;05;255m=[m [00;38;05;255mfocusFrameRef[m[00;38;05;255m();[m
  st[00;38;05;255m.[misRecording [00;38;05;255m=[m false[00;38;05;255m;[m
  [00;38;05;255msetFocusFrame[m[00;38;05;255m([mBUILTINS_FRAME[00;38;05;255m);[m
  [00;38;05;255msetFocusView[m[00;38;05;255m([mMACRO_BUF[00;38;05;255m);[m
  [00;38;05;255mbackwardStartOfElem[m[00;38;05;255m();[m
  [00;38;05;255msetFocusFrame[m[00;38;05;255m([mrefFrame[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mstartOrStopRecording[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mint[m refFrame [00;38;05;255m=[m [00;38;05;255mfocusFrameRef[m[00;38;05;255m();[m

  [00;38;05;75mif[m [00;38;05;255m([mst[00;38;05;255m.[misRecording [00;38;05;255m||[m refFrame [00;38;05;255m==[m BUILTINS_FRAME[00;38;05;255m)[m [00;38;05;196m{[m
    [00;38;05;255mstopRecording[m[00;38;05;255m();[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m

  [00;38;05;255m// start recording[m
  st[00;38;05;255m.[misRecording [00;38;05;255m=[m true[00;38;05;255m;[m
  [00;38;05;255msetFocusFrame[m[00;38;05;255m([mBUILTINS_FRAME[00;38;05;255m);[m
  [00;38;05;255msetFocusView[m[00;38;05;255m([mMACRO_BUF[00;38;05;255m);[m
  [00;38;05;255minsertNewElem[m[00;38;05;255m();[m
  [00;38;05;255m// BAL: if 1st line in macro buf is empty delete it (or reuse it)[m
  [00;38;05;255msetFocusFrame[m[00;38;05;255m([mrefFrame[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mstopRecordingOrPlayMacro[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mint[m refFrame [00;38;05;255m=[m [00;38;05;255mfocusFrameRef[m[00;38;05;255m();[m

  [00;38;05;75mif[m [00;38;05;255m([mst[00;38;05;255m.[misRecording [00;38;05;255m||[m refFrame [00;38;05;255m==[m BUILTINS_FRAME [00;38;05;255m||[m [00;38;05;255mfocusViewRef[m[00;38;05;255m()[m [00;38;05;255m==[m MACRO_BUF[00;38;05;255m)[m [00;38;05;196m{[m
    [00;38;05;255mstopRecording[m[00;38;05;255m();[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m

  [00;38;05;255m// play macro[m
  [00;38;05;255msetFocusFrame[m[00;38;05;255m([mBUILTINS_FRAME[00;38;05;255m);[m
  [00;38;05;255msetFocusView[m[00;38;05;255m([mMACRO_BUF[00;38;05;255m);[m
  [00;38;05;255mbackwardStartOfElem[m[00;38;05;255m();[m
  [00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc [00;38;05;255m=[m [00;38;05;255mfocusDoc[m[00;38;05;255m();[m
  [00;38;05;255mview_t[m [00;38;05;255m*[mview [00;38;05;255m=[m [00;38;05;255mfocusView[m[00;38;05;255m();[m

  [00;38;05;75mif[m [00;38;05;255m(![mdoc[00;38;05;255m->[mcontents[00;38;05;255m.[mstart[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255mmessage[m[00;38;05;255m([m[00;38;05;196m"no macros to play"[m[00;38;05;255m);[m
      [00;38;05;255msetFocusFrame[m[00;38;05;255m([mrefFrame[00;38;05;255m);[m
      [00;38;05;75mreturn[m[00;38;05;255m;[m
    [00;38;05;196m}[m

  [00;38;05;255msetFocusFrame[m[00;38;05;255m([mrefFrame[00;38;05;255m);[m
  [00;38;05;255mplayMacroCString[m[00;38;05;255m([mdoc[00;38;05;255m->[mcontents[00;38;05;255m.[mstart [00;38;05;255m+[m view[00;38;05;255m->[mcursor[00;38;05;255m.[moffset[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255m/* void setCursorToSearch() */[m
[00;38;05;255m/* { */[m
[00;38;05;255m/*     frame_t *frame = focusFrame(); */[m
[00;38;05;255m/*     if (noActiveSearch(frame)) return; */[m
[00;38;05;255m/*     view_t *view = focusView(); */[m
[00;38;05;255m/*     doc_t *doc = focusDoc(); */[m
[00;38;05;255m/*     uint *off = arrayFocus(&st.searchResults); */[m
[00;38;05;255m/*     cursorSetOffset(&view->cursor, *off, doc); */[m
[00;38;05;255m/*     cursorSetOffset(&view->selection, *off + st.searchLen - 1, doc); */[m
[00;38;05;255m/* } */[m

[00;38;05;255mvoid[m [00;38;05;255mforwardSearch[m[00;38;05;255m()[m
[00;38;05;196m{[m
[00;38;05;255m/*     st.searchResults.offset++; */[m
[00;38;05;255m/*     st.searchResults.offset %= st.searchResults.numElems; */[m
[00;38;05;255m/*     setCursorToSearch(); */[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mbackwardSearch[m[00;38;05;255m()[m
[00;38;05;196m{[m
[00;38;05;255m/*     st.searchResults.offset += st.searchResults.numElems - 1; */[m
[00;38;05;255m/*     st.searchResults.offset %= st.searchResults.numElems; */[m
[00;38;05;255m/*     setCursorToSearch(); */[m
[00;38;05;196m}[m

[00;38;05;255m/* void setCursorToSearch(); */[m

[00;38;05;255m/* void computeSearchResults() */[m
[00;38;05;255m/* { */[m
[00;38;05;255m/*     view_t *view = arrayElemAt(&st.views, st.searchRefView); */[m
[00;38;05;255m/*     doc_t *doc = docOf(view); */[m

[00;38;05;255m/*     int refView = focusViewRef(); */[m
[00;38;05;255m/*     setFocusView(SEARCH_BUF); */[m

[00;38;05;255m/*     view_t *viewFind = focusView(); */[m
[00;38;05;255m/*     doc_t *find = focusDoc(); */[m

[00;38;05;255m/*     cursor_t cursorFind; */[m
[00;38;05;255m/*     cursorCopy(&cursorFind, &viewFind->cursor); */[m
[00;38;05;255m/*     cursorSetRowCol(&cursorFind, cursorFind.row, 0, find); */[m

[00;38;05;255m/*     char *search = find->contents.start + cursorFind.offset; */[m
[00;38;05;255m/*     if (!search) goto nofree; */[m
[00;38;05;255m/*     char *replace = dieIfNull(strdup(search)); */[m
[00;38;05;255m/*     char *needle = strsep(&replace, "/"); */[m
[00;38;05;255m/*     st.searchLen = (uint)strlen(needle); */[m
[00;38;05;255m/*     if (st.searchLen == 0) goto done; */[m

[00;38;05;255m/*     char *haystack = doc->contents.start; */[m
[00;38;05;255m/*     char *p = haystack; */[m
[00;38;05;255m/*     arrayReinit(&st.searchResults); */[m
[00;38;05;255m/*     while ((p = strcasestr(p, needle))) */[m
[00;38;05;255m/*     { */[m
[00;38;05;255m/*         uint *off = arrayPushUninit(&st.searchResults); */[m
[00;38;05;255m/*         *off = (uint)(p - haystack); */[m
[00;38;05;255m/*         p++; */[m
[00;38;05;255m/*     } */[m

[00;38;05;255m/*     // copy replace string to copy buffer // BAL: don't use copy buffer ... */[m
[00;38;05;255m/*     if (replace) copy(replace, (uint)strlen(replace)); */[m
[00;38;05;255m/* done: */[m
[00;38;05;255m/*     free(needle); */[m
[00;38;05;255m/* nofree: */[m
[00;38;05;255m/*     setFocusView(refView); */[m
[00;38;05;255m/* } */[m

[00;38;05;255mvoid[m [00;38;05;255mnewSearch[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255msetFocusFrame[m[00;38;05;255m([mBUILTINS_FRAME[00;38;05;255m);[m
  [00;38;05;255msetFocusView[m[00;38;05;255m([mSEARCH_BUF[00;38;05;255m);[m
  [00;38;05;255msetInsertMode[m[00;38;05;255m();[m
  [00;38;05;255minsertNewElem[m[00;38;05;255m();[m
[00;38;05;196m}[m

[00;38;05;255m/* void gotoView() */[m
[00;38;05;255m/* { */[m
    [00;38;05;255m/* int frame = st.frames.offset; */[m

    [00;38;05;255m/* if (frame == BUILTINS_FRAME) frame = MAIN_FRAME; */[m

    [00;38;05;255m/* setFocusFrame(BUILTINS_FRAME); */[m
    [00;38;05;255m/* stSetViewFocus(BUFFERS_BUF); */[m

    [00;38;05;255m/* view_t *view = focusView(); */[m

    [00;38;05;255m/* setFocusFrame(frame); */[m
    [00;38;05;255m/* stSetViewFocus(view->cursor.row); */[m
[00;38;05;255m/* } */[m

[00;38;05;255mvoid[m [00;38;05;255mforwardFrame[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255msetFocusFrame[m[00;38;05;255m(([m[00;38;05;255mfocusFrameRef[m[00;38;05;255m()[m [00;38;05;255m+[m [00;38;05;171m1[m[00;38;05;255m)[m [00;38;05;255m%[m [00;38;05;255mnumFrames[m[00;38;05;255m());[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mbackwardFrame[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255msetFocusFrame[m[00;38;05;255m(([m[00;38;05;255mfocusFrameRef[m[00;38;05;255m()[m [00;38;05;255m+[m [00;38;05;255mnumFrames[m[00;38;05;255m()[m [00;38;05;255m-[m [00;38;05;171m1[m[00;38;05;255m)[m [00;38;05;255m%[m [00;38;05;255mnumFrames[m[00;38;05;255m());[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mforwardView[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255msetFocusView[m[00;38;05;255m(([m[00;38;05;255mfocusViewRef[m[00;38;05;255m()[m [00;38;05;255m+[m [00;38;05;171m1[m[00;38;05;255m)[m [00;38;05;255m%[m [00;38;05;255mnumViews[m[00;38;05;255m());[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mbackwardView[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255msetFocusView[m[00;38;05;255m(([m[00;38;05;255mfocusViewRef[m[00;38;05;255m()[m [00;38;05;255m+[m [00;38;05;255mnumViews[m[00;38;05;255m()[m [00;38;05;255m-[m [00;38;05;171m1[m[00;38;05;255m)[m [00;38;05;255m%[m [00;38;05;255mnumViews[m[00;38;05;255m());[m
[00;38;05;196m}[m

[00;38;05;33m#define[m INDENT_LENGTH [00;38;05;171m3[m

[00;38;05;255mint[m [00;38;05;255mnumLinesSelected[m[00;38;05;255m([m[00;38;05;255mchar[m [00;38;05;255m*[ms[00;38;05;255m,[m [00;38;05;255mint[m len[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;75mif[m [00;38;05;255m([mlen [00;38;05;255m<=[m [00;38;05;171m0[m[00;38;05;255m)[m [00;38;05;75mreturn[m [00;38;05;171m0[m[00;38;05;255m;[m
  [00;38;05;255mint[m n [00;38;05;255m=[m [00;38;05;255mnumLinesString[m[00;38;05;255m([ms[00;38;05;255m,[m len[00;38;05;255m);[m
  [00;38;05;75mif[m [00;38;05;255m(*([ms [00;38;05;255m+[m len [00;38;05;255m-[m [00;38;05;171m1[m[00;38;05;255m)[m [00;38;05;255m!=[m [00;38;05;196m'[m[00;38;05;255m\n[m[00;38;05;196m'[m[00;38;05;255m)[m n[00;38;05;255m++;[m
  [00;38;05;75mreturn[m n[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255minsertChars[m[00;38;05;255m([m[00;38;05;255mchar[m c[00;38;05;255m,[m [00;38;05;255mint[m n[00;38;05;255m)[m
[00;38;05;196m{[m
  [00;38;05;255massert[m[00;38;05;255m([mn [00;38;05;255m<[m [00;38;05;171m1024[m[00;38;05;255m);[m
  [00;38;05;255mchar[m s[00;38;05;255m[[m[00;38;05;171m1024[m[00;38;05;255m];[m
  [00;38;05;255mmemset[m[00;38;05;255m([ms[00;38;05;255m,[m c[00;38;05;255m,[m n[00;38;05;255m);[m
  [00;38;05;255minsertString[m[00;38;05;255m([ms[00;38;05;255m,[m n[00;38;05;255m);[m
[00;38;05;196m}[m

[00;38;05;255mint[m [00;38;05;255mindentLine[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mstring_t[m [00;38;05;255m*[ms [00;38;05;255m=[m [00;38;05;255m&[m[00;38;05;255mfocusDoc[m[00;38;05;255m()->[mcontents[00;38;05;255m;[m
  [00;38;05;255mbackwardSOL[m[00;38;05;255m();[m
  [00;38;05;255mint[m offset [00;38;05;255m=[m [00;38;05;255mfocusCursor[m[00;38;05;255m()->[moffset[00;38;05;255m;[m
  [00;38;05;255mint[m x [00;38;05;255m=[m [00;38;05;255mdistanceToIndent[m[00;38;05;255m([ms[00;38;05;255m->[mstart [00;38;05;255m+[m offset[00;38;05;255m,[m [00;38;05;255marrayTop[m[00;38;05;255m([ms[00;38;05;255m));[m
  [00;38;05;255mint[m n [00;38;05;255m=[m INDENT_LENGTH [00;38;05;255m-[m x [00;38;05;255m%[m INDENT_LENGTH[00;38;05;255m;[m
  [00;38;05;255minsertChars[m[00;38;05;255m([m[00;38;05;196m' '[m[00;38;05;255m,[m n[00;38;05;255m);[m
  [00;38;05;75mreturn[m n[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mint[m [00;38;05;255moutdentLine[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mdoc_t[m [00;38;05;255m*[mdoc [00;38;05;255m=[m [00;38;05;255mfocusDoc[m[00;38;05;255m();[m
  [00;38;05;255mstring_t[m [00;38;05;255m*[ms [00;38;05;255m=[m [00;38;05;255m&[mdoc[00;38;05;255m->[mcontents[00;38;05;255m;[m
  [00;38;05;255mbackwardSOL[m[00;38;05;255m();[m
  [00;38;05;255mint[m offset [00;38;05;255m=[m [00;38;05;255mfocusCursor[m[00;38;05;255m()->[moffset[00;38;05;255m;[m
  [00;38;05;255mint[m x [00;38;05;255m=[m [00;38;05;255mdistanceToIndent[m[00;38;05;255m([ms[00;38;05;255m->[mstart [00;38;05;255m+[m offset[00;38;05;255m,[m [00;38;05;255marrayTop[m[00;38;05;255m([ms[00;38;05;255m));[m
  [00;38;05;255mint[m n [00;38;05;255m=[m x [00;38;05;255m==[m [00;38;05;171m0[m [00;38;05;255m?[m [00;38;05;171m0[m [00;38;05;255m:[m [00;38;05;255m([mx [00;38;05;255m-[m [00;38;05;255m((([mx [00;38;05;255m-[m [00;38;05;171m1[m[00;38;05;255m)[m [00;38;05;255m/[m INDENT_LENGTH[00;38;05;255m)[m [00;38;05;255m*[m INDENT_LENGTH[00;38;05;255m));[m
  [00;38;05;255mdocPushDelete[m[00;38;05;255m([mdoc[00;38;05;255m,[m offset[00;38;05;255m,[m n[00;38;05;255m);[m
  [00;38;05;75mreturn[m n[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255mvoid[m [00;38;05;255mindentSelection[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255m// save a offset and b offset[m
  [00;38;05;255m// if:[m
  [00;38;05;255m//   l1 == l2 => indentLine, update a offset and b offset[m
  [00;38;05;255m//   l1 < l2 => indentLine, update a offset, indent intermediate lines, indentLine, update b offset[m

  [00;38;05;255m//   l1 > l2 => indentLine, update a offset, indent intermediate lines,[m
[00;38;05;196m}[m
[00;38;05;255mvoid[m [00;38;05;255mindent[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mint[m col[00;38;05;255m;[m
  [00;38;05;255mint[m row[00;38;05;255m;[m
  [00;38;05;255mint[m off[00;38;05;255m;[m
  [00;38;05;255mint[m len[00;38;05;255m;[m

  [00;38;05;255mgetSelectionCoords[m[00;38;05;255m([m[00;38;05;255mfocusView[m[00;38;05;255m(),[m [00;38;05;255m&[mcol[00;38;05;255m,[m [00;38;05;255m&[mrow[00;38;05;255m,[m [00;38;05;255m&[moff[00;38;05;255m,[m [00;38;05;255m&[mlen[00;38;05;255m);[m

  [00;38;05;255mint[m n [00;38;05;255m=[m [00;38;05;255mnumLinesSelected[m[00;38;05;255m([m[00;38;05;255mfocusDoc[m[00;38;05;255m()->[mcontents[00;38;05;255m.[mstart [00;38;05;255m+[m off[00;38;05;255m,[m len[00;38;05;255m);[m

  [00;38;05;255mint[m coff [00;38;05;255m=[m [00;38;05;255mfocusCursor[m[00;38;05;255m()->[moffset[00;38;05;255m;[m
  [00;38;05;255mint[m soff [00;38;05;255m=[m [00;38;05;255mfocusSelection[m[00;38;05;255m()->[moffset[00;38;05;255m;[m
  [00;38;05;255mint[m m [00;38;05;255m=[m [00;38;05;255mindentLine[m[00;38;05;255m();[m
  [00;38;05;255mint[m m0 [00;38;05;255m=[m m[00;38;05;255m;[m

  [00;38;05;75mif[m [00;38;05;255m([msoff [00;38;05;255m>=[m coff[00;38;05;255m)[m [00;38;05;196m{[m [00;38;05;255m// left to right highlight order[m
    [00;38;05;75mfor[m [00;38;05;255m([m[00;38;05;255mint[m i [00;38;05;255m=[m [00;38;05;171m1[m[00;38;05;255m;[m i [00;38;05;255m<[m n[00;38;05;255m;[m [00;38;05;255m++[mi[00;38;05;255m)[m
      [00;38;05;196m{[m
        [00;38;05;255mforwardLine[m[00;38;05;255m();[m
        m [00;38;05;255m+=[m [00;38;05;255mindentLine[m[00;38;05;255m();[m
      [00;38;05;196m}[m
    [00;38;05;255mcursorSetOffset[m[00;38;05;255m([m[00;38;05;255mfocusCursor[m[00;38;05;255m(),[m coff [00;38;05;255m+[m m0[00;38;05;255m,[m [00;38;05;255mfocusDoc[m[00;38;05;255m());[m
    [00;38;05;255mcursorSetOffset[m[00;38;05;255m([m[00;38;05;255mfocusSelection[m[00;38;05;255m(),[m soff [00;38;05;255m+[m m[00;38;05;255m,[m [00;38;05;255mfocusDoc[m[00;38;05;255m());[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m

  [00;38;05;255m// coff > soff // right to left highlight order[m
  [00;38;05;75mfor[m [00;38;05;255m([m[00;38;05;255mint[m i [00;38;05;255m=[m [00;38;05;171m1[m[00;38;05;255m;[m i [00;38;05;255m<[m n[00;38;05;255m;[m [00;38;05;255m++[mi[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255mbackwardLine[m[00;38;05;255m();[m
      m0 [00;38;05;255m=[m [00;38;05;255mindentLine[m[00;38;05;255m();[m
      m [00;38;05;255m+=[m m0[00;38;05;255m;[m
    [00;38;05;196m}[m

  [00;38;05;255mcursorSetOffset[m[00;38;05;255m([m[00;38;05;255mfocusCursor[m[00;38;05;255m(),[m coff [00;38;05;255m+[m m[00;38;05;255m,[m [00;38;05;255mfocusDoc[m[00;38;05;255m());[m
  [00;38;05;255mcursorSetOffset[m[00;38;05;255m([m[00;38;05;255mfocusSelection[m[00;38;05;255m(),[m soff [00;38;05;255m+[m m0[00;38;05;255m,[m [00;38;05;255mfocusDoc[m[00;38;05;255m());[m

[00;38;05;196m}[m
[00;38;05;255mvoid[m [00;38;05;255moutdent[m[00;38;05;255m()[m
[00;38;05;196m{[m
  [00;38;05;255mint[m col[00;38;05;255m;[m
  [00;38;05;255mint[m row[00;38;05;255m;[m
  [00;38;05;255mint[m off[00;38;05;255m;[m
  [00;38;05;255mint[m len[00;38;05;255m;[m

  [00;38;05;255mgetSelectionCoords[m[00;38;05;255m([m[00;38;05;255mfocusView[m[00;38;05;255m(),[m [00;38;05;255m&[mcol[00;38;05;255m,[m [00;38;05;255m&[mrow[00;38;05;255m,[m [00;38;05;255m&[moff[00;38;05;255m,[m [00;38;05;255m&[mlen[00;38;05;255m);[m

  [00;38;05;255mint[m n [00;38;05;255m=[m [00;38;05;255mnumLinesSelected[m[00;38;05;255m([m[00;38;05;255mfocusDoc[m[00;38;05;255m()->[mcontents[00;38;05;255m.[mstart [00;38;05;255m+[m off[00;38;05;255m,[m len[00;38;05;255m);[m

  [00;38;05;255mint[m coff [00;38;05;255m=[m [00;38;05;255mfocusCursor[m[00;38;05;255m()->[moffset[00;38;05;255m;[m
  [00;38;05;255mint[m soff [00;38;05;255m=[m [00;38;05;255mfocusSelection[m[00;38;05;255m()->[moffset[00;38;05;255m;[m
  [00;38;05;255mint[m m [00;38;05;255m=[m [00;38;05;255moutdentLine[m[00;38;05;255m();[m
  [00;38;05;255mint[m m0 [00;38;05;255m=[m m[00;38;05;255m;[m

  [00;38;05;75mif[m [00;38;05;255m([msoff [00;38;05;255m>=[m coff[00;38;05;255m)[m [00;38;05;196m{[m [00;38;05;255m// left to right highlight order[m
    [00;38;05;75mfor[m [00;38;05;255m([m[00;38;05;255mint[m i [00;38;05;255m=[m [00;38;05;171m1[m[00;38;05;255m;[m i [00;38;05;255m<[m n[00;38;05;255m;[m [00;38;05;255m++[mi[00;38;05;255m)[m
      [00;38;05;196m{[m
        [00;38;05;255mforwardLine[m[00;38;05;255m();[m
        m [00;38;05;255m+=[m [00;38;05;255moutdentLine[m[00;38;05;255m();[m
      [00;38;05;196m}[m
    [00;38;05;255mcursorSetOffset[m[00;38;05;255m([m[00;38;05;255mfocusCursor[m[00;38;05;255m(),[m coff [00;38;05;255m-[m m0[00;38;05;255m,[m [00;38;05;255mfocusDoc[m[00;38;05;255m());[m
    [00;38;05;255mcursorSetOffset[m[00;38;05;255m([m[00;38;05;255mfocusSelection[m[00;38;05;255m(),[m soff [00;38;05;255m-[m m[00;38;05;255m,[m [00;38;05;255mfocusDoc[m[00;38;05;255m());[m
    [00;38;05;75mreturn[m[00;38;05;255m;[m
  [00;38;05;196m}[m

  [00;38;05;255m// coff > soff // right to left highlight order[m
  [00;38;05;75mfor[m [00;38;05;255m([m[00;38;05;255mint[m i [00;38;05;255m=[m [00;38;05;171m1[m[00;38;05;255m;[m i [00;38;05;255m<[m n[00;38;05;255m;[m [00;38;05;255m++[mi[00;38;05;255m)[m
    [00;38;05;196m{[m
      [00;38;05;255mbackwardLine[m[00;38;05;255m();[m
      m0 [00;38;05;255m=[m [00;38;05;255moutdentLine[m[00;38;05;255m();[m
      m [00;38;05;255m+=[m m0[00;38;05;255m;[m
    [00;38;05;196m}[m

  [00;38;05;255mcursorSetOffset[m[00;38;05;255m([m[00;38;05;255mfocusCursor[m[00;38;05;255m(),[m coff [00;38;05;255m-[m m[00;38;05;255m,[m [00;38;05;255mfocusDoc[m[00;38;05;255m());[m
  [00;38;05;255mcursorSetOffset[m[00;38;05;255m([m[00;38;05;255mfocusSelection[m[00;38;05;255m(),[m soff [00;38;05;255m-[m m0[00;38;05;255m,[m [00;38;05;255mfocusDoc[m[00;38;05;255m());[m

[00;38;05;196m}[m
[00;38;05;255m/* void timerEvent() */[m
[00;38;05;255m/* { */[m
[00;38;05;255m/*   if (st.mouseSelectionInProgress) */[m
[00;38;05;255m/*     { */[m
[00;38;05;255m/*       focusTrackCursor(4); */[m
[00;38;05;255m/*       printf("boom\n"); */[m
[00;38;05;255m/*     } */[m
[00;38;05;255m/* } */[m
[00;38;05;255m/* Uint32 timerInit(Uint32 interval, void *param) */[m
[00;38;05;255m/* { */[m
[00;38;05;255m/*   SDL_Event event; */[m
[00;38;05;255m/*   SDL_UserEvent userevent; */[m

[00;38;05;255m/*   userevent.type = SDL_USEREVENT; */[m
[00;38;05;255m/*   userevent.code = 0; */[m
[00;38;05;255m/*   userevent.data1 = NULL; */[m
[00;38;05;255m/*   userevent.data2 = NULL; */[m

[00;38;05;255m/*   event.type = SDL_USEREVENT; */[m
[00;38;05;255m/*   event.user = userevent; */[m

[00;38;05;255m/*   SDL_PushEvent(&event); */[m
[00;38;05;255m/*   return(interval); */[m
[00;38;05;255m/* } */[m

[00;38;05;255mint[m [00;38;05;255mmain[m[00;38;05;255m([m[00;38;05;255mint[m argc[00;38;05;255m,[m [00;38;05;255mchar[m [00;38;05;255m**[margv[00;38;05;255m)[m
[00;38;05;196m{[m
    [00;38;05;255massert[m[00;38;05;255m([m[00;38;05;75msizeof[m[00;38;05;255m([m[00;38;05;255mchar[m[00;38;05;255m)[m [00;38;05;255m==[m [00;38;05;171m1[m[00;38;05;255m);[m
    [00;38;05;255massert[m[00;38;05;255m([m[00;38;05;75msizeof[m[00;38;05;255m([m[00;38;05;255mint[m[00;38;05;255m)[m [00;38;05;255m==[m [00;38;05;171m4[m[00;38;05;255m);[m
    [00;38;05;255massert[m[00;38;05;255m([m[00;38;05;75msizeof[m[00;38;05;255m([m[00;38;05;255munsigned[m [00;38;05;255mint[m[00;38;05;255m)[m [00;38;05;255m==[m [00;38;05;171m4[m[00;38;05;255m);[m
    [00;38;05;255massert[m[00;38;05;255m([m[00;38;05;75msizeof[m[00;38;05;255m([m[00;38;05;255mvoid[m[00;38;05;255m*)[m [00;38;05;255m==[m [00;38;05;171m8[m[00;38;05;255m);[m

    [00;38;05;255mstInit[m[00;38;05;255m([margc[00;38;05;255m,[m argv[00;38;05;255m);[m
    [00;38;05;255mstDraw[m[00;38;05;255m();[m
    [00;38;05;255m//    SDL_AddTimer(1000, timerInit, NULL);[m
    [00;38;05;75mwhile[m [00;38;05;255m([m[00;38;05;255mSDL_WaitEvent[m[00;38;05;255m(&[mst[00;38;05;255m.[mevent[00;38;05;255m))[m
    [00;38;05;196m{[m
        [00;38;05;75mswitch[m [00;38;05;255m([mst[00;38;05;255m.[mevent[00;38;05;255m.[mtype[00;38;05;255m)[m [00;38;05;196m{[m
            [00;38;05;75mcase[m SDL_WINDOWEVENT[00;38;05;255m:[m
                [00;38;05;255mwindowEvent[m[00;38;05;255m();[m
                [00;38;05;75mbreak[m[00;38;05;255m;[m
            [00;38;05;75mcase[m SDL_MOUSEWHEEL[00;38;05;255m:[m
                [00;38;05;255mmouseWheelEvent[m[00;38;05;255m();[m
                [00;38;05;75mbreak[m[00;38;05;255m;[m
            [00;38;05;75mcase[m SDL_MOUSEBUTTONDOWN[00;38;05;255m:[m
                [00;38;05;255mmouseButtonDownEvent[m[00;38;05;255m();[m
                [00;38;05;75mbreak[m[00;38;05;255m;[m
            [00;38;05;75mcase[m SDL_MOUSEBUTTONUP[00;38;05;255m:[m
                [00;38;05;255mmouseButtonUpEvent[m[00;38;05;255m();[m
                [00;38;05;75mbreak[m[00;38;05;255m;[m
            [00;38;05;75mcase[m SDL_MOUSEMOTION[00;38;05;255m:[m
                [00;38;05;255mmouseMotionEvent[m[00;38;05;255m();[m
                [00;38;05;75mbreak[m[00;38;05;255m;[m
            [00;38;05;75mcase[m SDL_KEYDOWN[00;38;05;255m:[m
                [00;38;05;255mkeyDownEvent[m[00;38;05;255m();[m
                [00;38;05;75mbreak[m[00;38;05;255m;[m
            [00;38;05;75mcase[m SDL_QUIT[00;38;05;255m:[m
                [00;38;05;255mquitEvent[m[00;38;05;255m();[m
                [00;38;05;75mbreak[m[00;38;05;255m;[m
            [00;38;05;75mcase[m SDL_USEREVENT[00;38;05;255m:[m
              [00;38;05;255m//                timerEvent();[m
                [00;38;05;75mbreak[m[00;38;05;255m;[m
[00;38;05;255m            default:[m
                [00;38;05;75mbreak[m[00;38;05;255m;[m
        [00;38;05;196m}[m
        [00;38;05;255mframeUpdate[m[00;38;05;255m([m[00;38;05;255mfocusFrame[m[00;38;05;255m());[m
        [00;38;05;255mstDraw[m[00;38;05;255m();[m
        [00;38;05;255m/* { */[m
        [00;38;05;255m/*     computeSearchResults(&st); */[m
        [00;38;05;255m/* } */[m
        [00;38;05;255m/* { */[m
        [00;38;05;255m/*   stDraw(); */[m
        [00;38;05;255m/*   stRenderFull(&st); */[m
        [00;38;05;255m/* { */[m
        [00;38;05;255m/*     stRender(&st); */[m
        [00;38;05;255m/* } */[m
    [00;38;05;196m}[m

  [00;38;05;75mreturn[m [00;38;05;171m0[m[00;38;05;255m;[m
[00;38;05;196m}[m

[00;38;05;255m/*[m
[mTODO:[m
[00;38;05;255mCORE:[m
[00;38;05;255m    Search and replace[m
[00;38;05;255m    Scroll when mouse selection goes off screen[m
[00;38;05;255m    command line args/config to set config items (e.g. demo mode)[m
[00;38;05;255m    status bar that has modified, etc.[m
[00;38;05;255m    cut/copy/paste with mouse[m
[00;38;05;255m    create new file[m
[00;38;05;255m    input screen (for search, paste, load, tab completion, etc.)[m
[00;38;05;255m    Hook Cut/Copy/Paste into system Cut/Copy/Paste[m
[00;38;05;255m    support editor API[m
[00;38;05;255m    Name macro[m
[00;38;05;255m    highlight compile errors/warnings[m
[00;38;05;255m    jump to next error[m
[00;38;05;255m    tab completion[m
[00;38;05;255m    sort lines[m
[00;38;05;255m    check spelling[m
[00;38;05;255m    jump to prev/next placeholders[m
[00;38;05;255m    jump to prev/next change[m
[00;38;05;255m    collapse/expand selection (code folding)[m
[00;38;05;255m    reload file when changed outside of editor[m
[00;38;05;255m    (tons of) optimizations[m
[00;38;05;255m    make builtin buffers readonly (except config and search?)[m

[00;38;05;255mVIS:[m
[00;38;05;255m    Display line number of every line[m
[00;38;05;255m    Minimap[m
[00;38;05;255m    syntax highlighting[m
[00;38;05;255m    highlight nested parens[m
[00;38;05;255m    resize nested parens[m
[00;38;05;255m    display multiple characters as one (e.g. lambda)[m
[00;38;05;255m    buffer list screen[m

[00;38;05;255mMACRO:[m
[00;38;05;255m    comment/uncomment region[m
[00;38;05;255m    more move, delete, insert commands[m
[00;38;05;255m    select all[m

[00;38;05;255mDONE:[m
[00;38;05;255m    continual compile (on exiting insert or delete).[m
[00;38;05;255mhelp screen[m
[00;38;05;255mUndo/Redo commands[m
[00;38;05;255mDisplay operation buffer during operation[m
[00;38;05;255mmultiple files[m
[00;38;05;255mTrack cursor when it goes off screen[m
[00;38;05;255mmake each frame have a list of independent views[m
[00;38;05;255mMove to next/prev blank line[m
[00;38;05;255mindent/outdent region[m
[00;38;05;255mindent/outdent line[m
[00;38;05;255mswitch between views[m
[00;38;05;255mswitch between frames[m
[00;38;05;255mstatus bar that has filename, row/col, mode.[m
[00;38;05;255mcursor per frame[m
[00;38;05;255mselect region with mouse[m
[00;38;05;255mstatus bar per frame[m
[00;38;05;255msplit screen[m
[00;38;05;255mRecord/play macro[m
[00;38;05;255mScroll[m
[00;38;05;255mMove cursor on mouse click[m
[00;38;05;255mFile automatically loads on startup[m
[00;38;05;255mFile automatically saves (on return)[m
[00;38;05;255mFile automatically checkpoints into git (on return)[m
[00;38;05;255mSelect region[m
[00;38;05;255mCut/Copy/Paste[m
[00;38;05;255mMove cursor to the start/end of a line[m
[00;38;05;255mMove cursor up/down[m
[00;38;05;255mMove cursor to next/prev whitespace[m
[00;38;05;255mInsert characters[m
[00;38;05;255mDelete characters[m
[00;38;05;255mEnforce cursor boundaries[m
[00;38;05;255mwait for events, don't poll[m
[00;38;05;255mswitch between insert and navigation mode[m
[00;38;05;255mDisplay filename and mode in status bar[m
[00;38;05;255mRedraw on window size change[m
[00;38;05;255mDisplay cursor[m
[00;38;05;255mMove cursor left/right[m
[00;38;05;255mDisplay text with spaces and newlines[m
[00;38;05;255mDisplay text[m
[00;38;05;255mDisplay window[m
[00;38;05;255mexit on quit[m
[00;38;05;255m*/[m
